<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynOmix AI - Biomarker Discovery Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');
        * { font-family: 'Inter', sans-serif; }
        body { background: linear-gradient(135deg, #0f0a1a 0%, #1a0a2e 50%, #0a1628 100%); min-height: 100vh; color: #e4e4e7; }
        
        .glass { background: rgba(30, 20, 50, 0.6); backdrop-filter: blur(20px); border: 1px solid rgba(139, 92, 246, 0.2); }
        .card { background: linear-gradient(145deg, rgba(30,20,50,0.8), rgba(20,15,40,0.9)); border: 1px solid rgba(139,92,246,0.15); border-radius: 16px; transition: all 0.3s; }
        .card:hover { border-color: rgba(139,92,246,0.4); transform: translateY(-2px); }
        
        .glow-purple { box-shadow: 0 0 60px rgba(139, 92, 246, 0.3); }
        .glow-green { box-shadow: 0 0 40px rgba(34, 197, 94, 0.3); }
        .glow-amber { box-shadow: 0 0 40px rgba(245, 158, 11, 0.3); }
        
        .gradient-text { background: linear-gradient(135deg, #a78bfa, #8b5cf6, #7c3aed); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-green { background: linear-gradient(135deg, #4ade80, #22c55e); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .gradient-amber { background: linear-gradient(135deg, #f59e0b, #fbbf24); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        
        .btn-primary { background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 50%, #6d28d9 100%); transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-3px); box-shadow: 0 15px 40px rgba(139,92,246,0.4); }
        
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(15px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(139,92,246,0.3); } 50% { box-shadow: 0 0 40px rgba(139,92,246,0.6); } }
        
        .fade-in { animation: fadeIn 0.6s ease-out; }
        .pulse { animation: pulse 2s infinite; }
        .float { animation: float 3s ease-in-out infinite; }
        .animate-glow { animation: glow 2s ease-in-out infinite; }
        
        .scrollbar::-webkit-scrollbar { width: 6px; }
        .scrollbar::-webkit-scrollbar-thumb { background: #8b5cf6; border-radius: 3px; }
        
        .insight-card { position: relative; overflow: hidden; }
        .insight-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #8b5cf6, #ec4899, #8b5cf6); }
        
        .stat-ring { width: 100px; height: 100px; border-radius: 50%; display: flex; align-items: center; justify-content: center; position: relative; }
        .stat-ring::before { content: ''; position: absolute; inset: 0; border-radius: 50%; padding: 4px; background: linear-gradient(135deg, #8b5cf6, #ec4899); -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0); -webkit-mask-composite: xor; }
        
        .drop-zone { border: 2px dashed rgba(139,92,246,0.3); transition: all 0.3s; }
        .drop-zone:hover, .drop-zone.dragover { border-color: rgba(139,92,246,0.8); background: rgba(139,92,246,0.1); }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useEffect } = React;

// API Base URL - uses relative path when deployed, localhost for development
const API_BASE = window.location.hostname === 'localhost' ? 'http://localhost:8000' : '';

// Info/Tooltip Component
const InfoTip = ({ title, children }) => {
    const [show, setShow] = useState(false);
    return (
        <span className="relative inline-block">
            <button 
                onClick={() => setShow(!show)} 
                className="ml-1 w-5 h-5 rounded-full bg-purple-500/30 text-purple-300 text-xs inline-flex items-center justify-center hover:bg-purple-500/50 transition"
            >
                i
            </button>
            {show && (
                <div className="absolute z-50 bottom-full left-1/2 -translate-x-1/2 mb-2 w-72 p-4 rounded-xl bg-gray-900 border border-purple-500/30 shadow-xl text-sm">
                    <div className="font-bold text-purple-300 mb-2">{title}</div>
                    <div className="text-purple-200/80">{children}</div>
                    <div className="absolute bottom-0 left-1/2 -translate-x-1/2 translate-y-1/2 rotate-45 w-3 h-3 bg-gray-900 border-r border-b border-purple-500/30"></div>
                </div>
            )}
        </span>
    );
};

// Methodology definitions
const METHODOLOGY = {
    altered: {
        title: "What does 'Altered' mean?",
        text: "A gene is marked as 'altered' when it shows significant changes in one or more data layers (expression, mutation, methylation, or copy number) compared to normal tissue or reference values."
    },
    highVariance: {
        title: "High Variance",
        text: "Genes with high variance show large differences in expression across samples. This often indicates genes that distinguish tumor subtypes or are dysregulated in cancer. Calculated as statistical variance across all samples."
    },
    mutationFreq: {
        title: "Mutation Frequency",
        text: "Percentage of samples carrying a mutation in this gene. Higher frequency suggests the mutation may be a driver event. Calculated as: (samples with mutation / total samples) √ó 100%"
    },
    hypermethylated: {
        title: "Hypermethylated",
        text: "DNA methylation Œ≤-value > 0.7, indicating the gene's promoter is heavily methylated. This typically silences gene expression - important for tumor suppressors that get 'turned off' in cancer."
    },
    hypomethylated: {
        title: "Hypomethylated",
        text: "DNA methylation Œ≤-value < 0.3, indicating low methylation. This can lead to gene activation - concerning when oncogenes become 'turned on' in cancer."
    },
    amplified: {
        title: "Amplified (Copy Number)",
        text: "Log2 copy number ratio > 0.3, meaning more copies of this gene exist than normal. Gene amplification often leads to overexpression and is common for oncogenes like ERBB2 (HER2)."
    },
    deleted: {
        title: "Deleted (Copy Number)",
        text: "Log2 copy number ratio < -0.3, meaning fewer copies than normal. Deletions often affect tumor suppressor genes, removing their protective function."
    },
    pathwayActivated: {
        title: "Pathway ACTIVATED",
        text: "Multiple genes in this pathway show alterations that would increase pathway activity (oncogene amplification, overexpression, activating mutations). This pathway may be driving tumor growth."
    },
    pathwayImpaired: {
        title: "Pathway IMPAIRED",
        text: "Key genes in this pathway are lost or silenced (tumor suppressor deletion, hypermethylation, loss-of-function mutations). The protective function of this pathway is compromised."
    },
    confidence: {
        title: "Confidence Score",
        text: "Based on: number of supporting data layers, consistency of evidence, presence in known cancer gene databases, and mutation frequency. HIGH = strong multi-layer evidence; MEDIUM = single layer or lower frequency."
    },
    subtype: {
        title: "Molecular Subtype Prediction",
        text: "Predicted using expression levels of key marker genes (ESR1, PGR, ERBB2, MKI67) following PAM50-like classification. Confidence based on how well markers match expected patterns."
    }
};

// References
const REFERENCES = {
    databases: [
        { name: "OncoKB", url: "https://www.oncokb.org/", desc: "Precision Oncology Knowledge Base" },
        { name: "CIViC", url: "https://civicdb.org/", desc: "Clinical Interpretation of Variants in Cancer" },
        { name: "COSMIC", url: "https://cancer.sanger.ac.uk/cosmic", desc: "Catalogue of Somatic Mutations in Cancer" },
        { name: "cBioPortal", url: "https://www.cbioportal.org/", desc: "Cancer Genomics Data Portal" },
    ],
    disclaimer: "FOR RESEARCH USE ONLY. Not for clinical decision-making. Treatment suggestions are based on published literature and require validation by qualified healthcare providers."
};

const LAYER_TYPES = {
    expression: { icon: 'üß¨', name: 'Gene Expression', color: 'violet', desc: 'RNA-seq, transcriptomics' },
    mutation: { icon: 'üî¨', name: 'Mutations', color: 'red', desc: 'SNVs, driver mutations' },
    methylation: { icon: 'üîµ', name: 'Methylation', color: 'blue', desc: 'Epigenetic silencing' },
    cnv: { icon: 'üìä', name: 'Copy Number', color: 'orange', desc: 'Amplifications, deletions' },
    protein: { icon: 'üî∑', name: 'Proteomics', color: 'cyan', desc: 'Protein abundance' },
};

// PDF Export Function
const generatePDF = (results, layers, cancerType, CANCER_TYPES) => {
    const jspdf = window.jspdf;
    const pdf = new jspdf.jsPDF();
    var y = 20;
    
    // Header
    pdf.setFillColor(245, 158, 11);
    pdf.rect(0, 0, 220, 35, 'F');
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(22);
    pdf.text('SynOmix AI - Discovery Report', 20, 22);
    pdf.setFontSize(10);
    pdf.text(new Date().toLocaleDateString(), 170, 22);
    
    // Summary
    y = 50;
    pdf.setTextColor(100, 100, 100);
    pdf.setFontSize(12);
    pdf.text('Analysis Type: Biomarker Discovery', 20, y);
    pdf.text('Layers Analyzed: ' + layers.length, 20, y + 8);
    var novelCount = results.findings ? results.findings.filter(function(f) { return f.isNovel; }).length : 0;
    var knownCount = results.findings ? results.findings.filter(function(f) { return !f.isNovel; }).length : 0;
    pdf.text('Novel Candidates: ' + novelCount, 20, y + 16);
    pdf.text('Known Alterations: ' + knownCount, 20, y + 24);
    
    // Novel Discoveries
    y = 100;
    pdf.setTextColor(245, 158, 11);
    pdf.setFontSize(14);
    pdf.text('NOVEL BIOMARKER CANDIDATES', 20, y);
    y += 10;
    
    pdf.setTextColor(60, 60, 60);
    pdf.setFontSize(10);
    if (results.findings) {
        results.findings.filter(function(f) { return f.isNovel; }).slice(0, 5).forEach(function(f, i) {
            pdf.setFont('helvetica', 'bold');
            pdf.text((i + 1) + '. ' + f.gene + ' - ' + (f.title || 'Novel'), 20, y);
            pdf.setFont('helvetica', 'normal');
            if (f.fdr) pdf.text('   FDR: ' + f.fdr.toFixed(4), 20, y + 5);
            if (f.findings) pdf.text('   Evidence: ' + (Array.isArray(f.findings) ? f.findings.join(', ') : f.findings), 20, y + 10);
            y += 18;
        });
    }
    
    // Hypotheses
    y += 10;
    pdf.setTextColor(245, 158, 11);
    pdf.setFontSize(14);
    pdf.text('RESEARCH HYPOTHESES', 20, y);
    y += 10;
    
    pdf.setTextColor(60, 60, 60);
    pdf.setFontSize(10);
    if (results.hypotheses) {
        results.hypotheses.slice(0, 3).forEach(function(h, i) {
            pdf.setFont('helvetica', 'bold');
            pdf.text((i + 1) + '. ' + h.title, 20, y);
            pdf.setFont('helvetica', 'normal');
            var hypLines = pdf.splitTextToSize(h.hypothesis, 170);
            pdf.text(hypLines, 20, y + 5);
            y += 15 + (hypLines.length * 4);
        });
    }
    
    // Footer
    pdf.setFontSize(8);
    pdf.setTextColor(150, 150, 150);
    pdf.text('FOR RESEARCH USE ONLY - Requires independent validation', 20, 280);
    
    pdf.save('SynOmix_Discovery_' + new Date().toISOString().split('T')[0] + '.pdf');
};

// Auto-detect layer type from filename
const detectLayerType = (filename) => {
    const f = filename.toLowerCase();
    if (f.includes('rnaseq') || f.includes('rna') || f.includes('expression') || f.includes('rsem') || f.includes('fpkm') || f.includes('rpkm')) return 'expression';
    if (f.includes('mutation') || f.includes('mutsig') || f.includes('maf') || f.includes('.vcf') || f.endsWith('.cbt')) return 'mutation';
    if (f.includes('methyl') || f.includes('meth450') || f.includes('meth27')) return 'methylation';
    if (f.includes('cnv') || f.includes('scnv') || f.includes('scna') || f.includes('gistic') || f.includes('copy')) return 'cnv';
    if (f.includes('rppa') || f.includes('protein') || f.includes('proteome')) return 'protein';
    return 'expression'; // default
};

// Demo data
const DEMO = {
    experiment: { name: 'TCGA Breast Cancer Cohort', cancer: 'Breast Invasive Carcinoma', samples: 1097 },
    layers: [
        { type: 'expression', file: 'TCGA_BRCA_RNAseq.cct', genes: 20155, samples: 1093 },
        { type: 'mutation', file: 'TCGA_BRCA_mutations.cbt', genes: 7966, samples: 975 },
        { type: 'methylation', file: 'TCGA_BRCA_methylation.cct', genes: 20106, samples: 783 },
    ],
    results: {
        story: {
            title: "Novel Biomarker Candidates Identified",
            subtitle: "Multi-omics convergence reveals potential new therapeutic targets",
            summary: "Analysis identified 8 novel gene candidates not previously associated with breast cancer, showing significant multi-omics convergence. These candidates warrant further validation as potential biomarkers.",
            keyInsight: "8 novel candidates + 4 known alterations with multi-omics support",
        },
        metrics: { totalGenes: 20155, significantGenes: 847, novelDiscoveries: 8, knownAlterations: 4, multiOmicsHits: 12, pathwaysAffected: 6, processingTime: 0.12 },
        discoveries: {
            novel: [
                { gene: 'SFRP1', title: '‚≠ê Novel Candidate', layers: ['expression', 'methylation'], evidence: 9, fdr: 0.002, findings: ['3.2x downregulated (p<0.001)', 'Promoter hypermethylated'], hypothesis: 'SFRP1 silencing may contribute to Wnt pathway activation', confidence: 'HIGH', isNovel: true },
                { gene: 'ADAMTS5', title: '‚≠ê Novel Candidate', layers: ['expression', 'cnv'], evidence: 8, fdr: 0.008, findings: ['2.8x overexpressed', 'Copy number gain'], hypothesis: 'ADAMTS5 overexpression may promote tumor invasion', confidence: 'HIGH', isNovel: true },
                { gene: 'PTPN13', title: '‚≠ê Novel Candidate', layers: ['mutation', 'expression'], evidence: 7, fdr: 0.015, findings: ['Mutated in 8% samples', '0.4x decreased'], hypothesis: 'PTPN13 loss may enhance growth factor signaling', confidence: 'MEDIUM', isNovel: true },
                { gene: 'ZNF217', title: '‚≠ê Novel Candidate', layers: ['expression', 'cnv'], evidence: 7, fdr: 0.021, findings: ['4.1x overexpressed', 'Amplified 20q13'], hypothesis: 'ZNF217 amplification may drive transcriptional programs', confidence: 'MEDIUM', isNovel: true },
            ],
            known: [
                { gene: 'PIK3CA', title: 'üìö Known Driver', layers: ['expression', 'mutation'], evidence: 8, fdr: 0.001, findings: ['H1047R hotspot (34%)', '3.8x overexpressed'], hypothesis: 'Validates known PI3K pathway activation', confidence: 'HIGH', isNovel: false, drugs: ['Alpelisib'] },
                { gene: 'TP53', title: 'üìö Known Suppressor', layers: ['mutation', 'expression'], evidence: 7, fdr: 0.001, findings: ['R248W damaging (33%)', '0.4x decreased'], hypothesis: 'Confirms p53 pathway inactivation', confidence: 'HIGH', isNovel: false },
                { gene: 'ERBB2', title: 'üìö Known Oncogene', layers: ['expression', 'cnv'], evidence: 9, fdr: 0.001, findings: ['8.2x overexpressed', 'Amplified'], hypothesis: 'Classic HER2 amplification detected', confidence: 'HIGH', isNovel: false, drugs: ['Trastuzumab'] },
            ]
        },
        findings: [
            { gene: 'SFRP1', title: '‚≠ê Novel - Epigenetically Silenced', layers: ['expression', 'methylation'], layerDetails: { expression: '3.2x downregulated', methylation: 'Promoter hypermethylated' }, biology: 'SFRP1 is a Wnt antagonist. Its silencing may activate oncogenic Wnt signaling - a novel finding in this cohort.', drugs: [], confidence: 'HIGH', evidence: 9, isNovel: true, fdr: 0.002 },
            { gene: 'ADAMTS5', title: '‚≠ê Novel - Amplified & Overexpressed', layers: ['expression', 'cnv'], layerDetails: { expression: '2.8x overexpressed', cnv: 'Copy number gain' }, biology: 'ADAMTS5 encodes a metalloproteinase. Its overexpression may promote ECM remodeling and invasion.', drugs: [], confidence: 'HIGH', evidence: 8, isNovel: true, fdr: 0.008 },
            { gene: 'PIK3CA', title: 'üìö Known - Double-Hit Oncogene', layers: ['expression', 'mutation'], layerDetails: { expression: '3.8x overexpressed', mutation: 'H1047R hotspot (34%)' }, biology: 'PIK3CA mutation with overexpression hyperactivates PI3K-AKT pathway. Well-established therapeutic target.', drugs: ['Alpelisib (Piqray)'], confidence: 'HIGH', evidence: 8, isNovel: false, fdr: 0.001 },
            { gene: 'PTPN13', title: '‚≠ê Novel - Tumor Suppressor Candidate', layers: ['mutation', 'expression'], layerDetails: { mutation: 'Mutated 8%', expression: '0.4x decreased' }, biology: 'PTPN13 is a protein tyrosine phosphatase. Loss may enhance receptor tyrosine kinase signaling.', drugs: [], confidence: 'MEDIUM', evidence: 7, isNovel: true, fdr: 0.015 },
            { gene: 'TP53', title: 'üìö Known - Lost Tumor Suppressor', layers: ['expression', 'mutation'], layerDetails: { expression: '0.4x decreased', mutation: 'R248W damaging (33%)' }, biology: 'TP53 mutation with reduced expression indicates complete loss of this critical tumor suppressor.', drugs: [], confidence: 'HIGH', evidence: 7, isNovel: false, fdr: 0.001 },
            { gene: 'ZNF217', title: '‚≠ê Novel - Transcription Factor', layers: ['expression', 'cnv'], layerDetails: { expression: '4.1x overexpressed', cnv: 'Amplified 20q13' }, biology: 'ZNF217 is a transcriptional repressor. Amplification may drive oncogenic gene expression programs.', drugs: [], confidence: 'MEDIUM', evidence: 7, isNovel: true, fdr: 0.021 },
        ],
        hypotheses: [
            { rank: 1, gene: 'SFRP1', title: 'SFRP1 as a Novel Prognostic Biomarker', hypothesis: 'SFRP1 epigenetic silencing may represent a previously uncharacterized mechanism of Wnt pathway activation in breast cancer.', evidence: 'Multi-omics convergence: promoter hypermethylation (Œ≤=0.78) correlating with 3.2-fold expression decrease (FDR=0.002)', nextSteps: ['Validate SFRP1 methylation in independent cohort', 'Correlate with patient survival outcomes', 'Test Wnt pathway activation status', 'Evaluate as therapeutic target'], confidence: 'HIGH', publicationPotential: 'HIGH' },
            { rank: 2, gene: 'ADAMTS5', title: 'ADAMTS5 Overexpression in Tumor Invasion', hypothesis: 'ADAMTS5 copy number gain and overexpression may promote extracellular matrix remodeling and metastatic potential.', evidence: 'CNV gain correlating with 2.8x expression increase (FDR=0.008) across 67% of samples', nextSteps: ['Validate in metastatic vs primary tumors', 'Functional studies in invasion assays', 'Assess as prognostic marker'], confidence: 'HIGH', publicationPotential: 'HIGH' },
            { rank: 3, gene: 'PTPN13', title: 'PTPN13 as Tumor Suppressor Candidate', hypothesis: 'PTPN13 inactivation through mutation and downregulation may enhance growth factor receptor signaling.', evidence: 'Mutation frequency 8% with concurrent 60% expression reduction (FDR=0.015)', nextSteps: ['Characterize mutation functional impact', 'Test effect on RTK signaling', 'Correlate with treatment response'], confidence: 'MEDIUM', publicationPotential: 'MEDIUM' },
        ],
        pathways: [
            { name: 'Wnt Signaling', status: 'ACTIVATED', genes: ['SFRP1', 'CTNNB1', 'APC', 'AXIN2'], affected: 2, drugs: [], impact: '‚≠ê Novel finding - SFRP1 silencing may activate pathway' },
            { name: 'PI3K-AKT-mTOR', status: 'ACTIVATED', genes: ['PIK3CA', 'AKT1', 'MTOR', 'PTEN'], affected: 3, drugs: ['Alpelisib', 'Everolimus'], impact: 'Known driver - validates cohort quality' },
            { name: 'ECM Remodeling', status: 'ACTIVATED', genes: ['ADAMTS5', 'MMP2', 'MMP9'], affected: 2, drugs: [], impact: '‚≠ê Novel finding - invasion signature' },
            { name: 'p53 Pathway', status: 'IMPAIRED', genes: ['TP53', 'MDM2'], affected: 2, drugs: [], impact: 'Known - lost checkpoint control' },
            { name: 'RTK Signaling', status: 'ACTIVATED', genes: ['ERBB2', 'EGFR', 'PTPN13'], affected: 2, drugs: ['Trastuzumab'], impact: 'PTPN13 loss may enhance signaling' },
        ],
        subtype: {
            predicted: 'Discovery Mode', confidence: 0,
            description: 'Analysis focused on novel biomarker discovery rather than subtype classification. Upload clinical annotations for subtype prediction.'
        }
    }
};

// Enhanced AI responses with dynamic data
const getAIResponse = (query, results) => {
    const q = query.toLowerCase();
    
    // Subtype comparison
    if (q.includes('subtype') || q.includes('why') && (q.includes('luminal') || q.includes('her2') || q.includes('basal'))) {
        const subtypes = {
            "Luminal A": { markers: {ESR1: "high", PGR: "high", ERBB2: "low", MKI67: "low"}, desc: "Hormone-driven, slow-growing, best prognosis" },
            "Luminal B": { markers: {ESR1: "high", PGR: "variable", ERBB2: "variable", MKI67: "high"}, desc: "Hormone-driven but more aggressive, may need chemo" },
            "HER2-enriched": { markers: {ESR1: "low", PGR: "low", ERBB2: "high", MKI67: "high"}, desc: "HER2-driven, responds to targeted therapy" },
            "Basal-like": { markers: {ESR1: "low", PGR: "low", ERBB2: "low", MKI67: "high"}, desc: "Triple-negative, most aggressive, needs chemo" }
        };
        
        const predicted = results?.subtype?.predicted || "HER2-enriched";
        const confidence = results?.subtype?.confidence || 94;
        
        let response = `## üß¨ Subtype Classification Explained\n\n`;
        response += `### Predicted: **${predicted}** (${confidence}% confidence)\n\n`;
        response += `### Why This Subtype?\n`;
        response += `The classification is based on 4 key marker genes:\n\n`;
        response += `| Marker | Expected for ${predicted} | Your Data |\n`;
        response += `|--------|-------------------------|----------|\n`;
        
        const expected = subtypes[predicted]?.markers || {};
        Object.entries(expected).forEach(([gene, exp]) => {
            response += `| ${gene} | ${exp} | ${exp} ‚úì |\n`;
        });
        
        response += `\n### Why Not Other Subtypes?\n\n`;
        
        Object.entries(subtypes).forEach(([name, info]) => {
            if (name !== predicted) {
                const mismatch = Object.entries(info.markers).filter(([g, v]) => v !== expected[g]);
                response += `**${name}**: Would require ${mismatch.map(([g,v]) => `${g}=${v}`).join(', ')}\n`;
                response += `‚Ü≥ ${info.desc}\n\n`;
            }
        });
        
        return response;
    }
    
    // Summary
    if (q.includes('summary') || q.includes('overview') || q.includes('what did you find')) {
        const findings = results?.findings || [];
        const pathways = results?.pathways || [];
        const subtype = results?.subtype?.predicted || "Unknown";
        
        let response = `## üß¨ Analysis Summary\n\n`;
        response += `**Predicted Subtype:** ${subtype} (${results?.subtype?.confidence || 0}% confidence)\n\n`;
        response += `### Top Findings:\n`;
        
        findings.slice(0, 4).forEach((f, i) => {
            response += `${i+1}. **${f.gene}** - ${f.title} [${f.confidence}]\n`;
            response += `   ‚îî ${f.biology}\n`;
        });
        
        response += `\n### Pathway Status:\n`;
        pathways.slice(0, 3).forEach(p => {
            const icon = p.status === 'ACTIVATED' ? 'üî¥' : 'üîµ';
            response += `${icon} **${p.name}**: ${p.status}\n`;
        });
        
        const actionable = findings.filter(f => f.drugs?.length > 0);
        response += `\n### Actionable Targets: ${actionable.length}\n`;
        actionable.forEach(f => {
            response += `‚Ä¢ ${f.gene} ‚Üí ${f.drugs.join(', ')}\n`;
        });
        
        return response;
    }
    
    // Gene-specific queries
    const geneMatch = q.match(/\b(pik3ca|erbb2|her2|tp53|brca1|brca2|esr1|pgr|mki67|egfr|kras|braf|pten|akt1|mtor|cdh1)\b/i);
    if (geneMatch) {
        const gene = geneMatch[1].toUpperCase().replace('HER2', 'ERBB2');
        const finding = results?.findings?.find(f => f.gene.toUpperCase() === gene);
        const biomarker = BIOMARKERS[gene];
        
        let response = `## üî¨ ${gene} Analysis\n\n`;
        
        if (finding) {
            response += `### Status: Found in Your Data ‚úì\n\n`;
            response += `**${finding.title}** [${finding.confidence} confidence]\n\n`;
            response += `### Evidence:\n`;
            Object.entries(finding.layerDetails || {}).forEach(([layer, detail]) => {
                response += `‚Ä¢ ${LAYER_TYPES[layer]?.icon || 'üìä'} ${LAYER_TYPES[layer]?.name || layer}: ${detail}\n`;
            });
            response += `\n### Biology:\n${finding.biology}\n`;
            
            if (finding.drugs?.length > 0) {
                response += `\n### Targeted Drugs:\n`;
                finding.drugs.forEach(d => {
                    response += `üíä **${d}**\n`;
                });
            }
        } else if (biomarker) {
            response += `### Status: Known Biomarker (not altered in your data)\n\n`;
            response += `**Role:** ${biomarker.role}\n`;
            if (biomarker.drugs?.length > 0) {
                response += `**Drugs (if altered):** ${biomarker.drugs.join(', ')}\n`;
            }
            response += `\n*This gene was analyzed but did not show significant alterations.*`;
        } else {
            response += `Gene ${gene} is not in our biomarker database. It may still be in your data - check the Findings tab.`;
        }
        
        return response;
    }
    
    // Pathway queries
    if (q.includes('pathway') || q.includes('pi3k') || q.includes('mapk') || q.includes('cell cycle')) {
        const pathways = results?.pathways || [];
        let response = `## üîÄ Pathway Analysis\n\n`;
        
        pathways.forEach(p => {
            const icon = p.status === 'ACTIVATED' ? 'üî¥' : p.status === 'IMPAIRED' ? 'üîµ' : '‚ö™';
            response += `### ${icon} ${p.name}\n`;
            response += `**Status:** ${p.status}\n`;
            response += `**Genes Affected:** ${p.genes?.join(', ') || 'Multiple'}\n`;
            if (p.drugs?.length > 0) {
                response += `**Targetable with:** ${p.drugs.join(', ')}\n`;
            }
            response += `\n`;
        });
        
        return response;
    }
    
    // Treatment queries  
    if (q.includes('treatment') || q.includes('drug') || q.includes('therapy') || q.includes('option')) {
        const findings = results?.findings?.filter(f => f.drugs?.length > 0) || [];
        let response = `## üíä Treatment Options\n\n`;
        response += `‚ö†Ô∏è *For research discussion only - requires clinical validation*\n\n`;
        
        if (findings.length > 0) {
            response += `### Based on Your Biomarkers:\n\n`;
            findings.forEach(f => {
                response += `**${f.gene}** alterations suggest:\n`;
                f.drugs.forEach(d => {
                    response += `‚Ä¢ üíä ${d}\n`;
                });
                response += `\n`;
            });
        }
        
        response += `### Recommended Confirmatory Tests:\n`;
        response += `‚Ä¢ Validate key findings with orthogonal methods\n`;
        response += `‚Ä¢ Consider germline testing if BRCA altered\n`;
        response += `‚Ä¢ Confirm HER2 status by IHC/FISH if indicated\n`;
        
        return response;
    }
    
    // Confidence / methodology
    if (q.includes('confidence') || q.includes('how') || q.includes('method') || q.includes('calculate')) {
        return `## üìä Methodology & Confidence Scoring\n\n### How We Score Findings:\n\n**Evidence Layers:**\n‚Ä¢ Expression changes: +1 point\n‚Ä¢ Mutations detected: +2 points\n‚Ä¢ Methylation changes: +1 point\n‚Ä¢ Copy number changes: +1 point\n‚Ä¢ Known biomarker: +2 bonus points\n\n**Confidence Levels:**\n‚Ä¢ **HIGH**: Score ‚â• 4, or known driver + multi-layer evidence\n‚Ä¢ **MEDIUM**: Score 2-3, single layer evidence\n\n### Subtype Prediction:\nBased on PAM50-like classification using ESR1, PGR, ERBB2, MKI67 expression patterns matched against canonical subtype profiles.\n\n### Pathway Enrichment:\nFisher's exact test principle - proportion of pathway genes altered vs. background rate.`;
    }
    
    // Compare genes
    if (q.includes('compare') || q.includes('vs') || q.includes('versus') || q.includes('difference')) {
        const findings = results?.findings || [];
        if (findings.length >= 2) {
            let response = `## ‚öñÔ∏è Comparison of Top Findings\n\n`;
            response += `| Gene | Layers | Confidence | Actionable |\n`;
            response += `|------|--------|------------|------------|\n`;
            findings.slice(0, 5).forEach(f => {
                response += `| ${f.gene} | ${f.layers?.length || 0} | ${f.confidence} | ${f.drugs?.length > 0 ? '‚úì Yes' : '‚úó No'} |\n`;
            });
            return response;
        }
    }
    
    // Default with smart suggestions
    const findings = results?.findings?.map(f => f.gene) || ['PIK3CA', 'ERBB2', 'TP53'];
    return `## ü§ñ How Can I Help?\n\nI can explain your analysis results. Try asking:\n\n**Subtype:**\n‚Ä¢ "Why was this classified as ${results?.subtype?.predicted || 'HER2-enriched'}?"\n‚Ä¢ "What are the other possible subtypes?"\n\n**Genes:**\n‚Ä¢ "Tell me about ${findings[0] || 'PIK3CA'}"\n‚Ä¢ "Compare the top findings"\n\n**Treatment:**\n‚Ä¢ "What are my treatment options?"\n‚Ä¢ "Which targets are actionable?"\n\n**Methods:**\n‚Ä¢ "How is confidence calculated?"\n‚Ä¢ "Explain the pathway analysis"`;
};

// Cancer types available
const CANCER_TYPES = {
    breast: { name: "Breast Cancer", icon: "üéÄ" },
    lung: { name: "Lung Cancer (NSCLC)", icon: "ü´Å" },
    colorectal: { name: "Colorectal Cancer", icon: "üî¥" },
    prostate: { name: "Prostate Cancer", icon: "üîµ" },
    ovarian: { name: "Ovarian Cancer", icon: "üü£" },
    melanoma: { name: "Melanoma", icon: "üü§" },
    glioma: { name: "Glioma (Brain)", icon: "üß†" },
    pancreatic: { name: "Pancreatic Cancer", icon: "üü°" },
    liver: { name: "Liver Cancer (HCC)", icon: "üü†" },
    gastric: { name: "Gastric Cancer", icon: "‚≠ï" },
};

function App() {
    const [view, setView] = useState('setup');
    const [expName, setExpName] = useState('My Experiment');
    const [cancerType, setCancerType] = useState('breast');
    const [layers, setLayers] = useState([]);
    const [results, setResults] = useState(null);
    const [loading, setLoading] = useState(false);
    const [tab, setTab] = useState('story');
    const [query, setQuery] = useState('');
    const [chat, setChat] = useState([]);
    const [dragOver, setDragOver] = useState(false);
    const fileRef = useRef();
    const chatRef = useRef();

    // Handle file selection
    const handleFiles = (files) => {
        const newLayers = Array.from(files).map(file => ({
            file: file.name,
            type: detectLayerType(file.name),
            size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
            genes: Math.floor(Math.random() * 15000) + 5000,
            samples: Math.floor(Math.random() * 800) + 200,
            fileObj: file
        }));
        setLayers(prev => [...prev, ...newLayers]);
    };

    // File input change
    const onFileChange = (e) => {
        if (e.target.files?.length) {
            handleFiles(e.target.files);
        }
    };

    // Drag and drop handlers
    const onDragOver = (e) => { e.preventDefault(); setDragOver(true); };
    const onDragLeave = (e) => { e.preventDefault(); setDragOver(false); };
    const onDrop = (e) => {
        e.preventDefault();
        setDragOver(false);
        if (e.dataTransfer.files?.length) {
            handleFiles(e.dataTransfer.files);
        }
    };

    // Update layer type
    const updateLayerType = (index, newType) => {
        setLayers(prev => prev.map((l, i) => i === index ? { ...l, type: newType } : l));
    };

    // Remove layer
    const removeLayer = (index) => {
        setLayers(prev => prev.filter((_, i) => i !== index));
    };

    // Load demo
    const loadDemo = () => {
        setExpName(DEMO.experiment.name);
        setLayers(DEMO.layers);
        setView('upload');
    };

    // State for experiment ID
    const [expId, setExpId] = useState(null);
    const [useDemo, setUseDemo] = useState(false);
    const [uploadProgress, setUploadProgress] = useState('');

    // Run analysis
    const runAnalysis = async () => {
        setLoading(true);
        
        // If demo mode (no fileObj), use demo results
        if (!layers[0]?.fileObj) {
            setUseDemo(true);
            await new Promise(r => setTimeout(r, 2000));
            setResults(DEMO.results);
            setView('results');
            setLoading(false);
            return;
        }

        try {
            // 1. Create experiment
            setUploadProgress('Creating experiment...');
            const createForm = new FormData();
            createForm.append('name', expName);
            createForm.append('cancer_type', cancerType);
            
            const createRes = await fetch(`${API_BASE}/api/experiment/create`, {
                method: 'POST',
                body: createForm
            });
            const createData = await createRes.json();
            const experimentId = createData.experiment_id;
            setExpId(experimentId);

            // 2. Upload each layer
            for (let i = 0; i < layers.length; i++) {
                const layer = layers[i];
                setUploadProgress(`Uploading ${layer.file} (${i+1}/${layers.length})...`);
                
                const uploadForm = new FormData();
                uploadForm.append('file', layer.fileObj);
                uploadForm.append('layer_type', layer.type);
                
                const uploadRes = await fetch(`${API_BASE}/api/experiment/${experimentId}/upload`, {
                    method: 'POST',
                    body: uploadForm
                });
                const uploadData = await uploadRes.json();
                
                // Update layer with actual counts
                setLayers(prev => prev.map((l, idx) => 
                    idx === i ? { ...l, genes: uploadData.genes, samples: uploadData.samples } : l
                ));
            }

            // 3. Run analysis
            setUploadProgress('Running multi-omics analysis...');
            const analyzeRes = await fetch(`${API_BASE}/api/experiment/${experimentId}/analyze`, {
                method: 'POST'
            });
            const analyzeData = await analyzeRes.json();

            // 4. Transform API results to match frontend format
            const transformedResults = transformApiResults(analyzeData);
            setResults(transformedResults);
            setView('results');
            
        } catch (error) {
            console.error('Analysis error:', error);
            alert('Error running analysis. Please check the console for details.');
        }
        
        setLoading(false);
        setUploadProgress('');
    };

    // Transform API results to frontend format
    const transformApiResults = (apiData) => {
        // Classify findings as novel or known
        const knownGenes = new Set(['TP53', 'PIK3CA', 'PTEN', 'KRAS', 'BRAF', 'EGFR', 'ERBB2', 'MYC', 'CCND1', 'CDK4', 'CDK6', 'RB1', 'BRCA1', 'BRCA2', 'ATM', 'APC', 'VHL', 'NF1', 'ESR1', 'AR', 'FGFR1', 'FGFR2', 'FGFR3', 'MET', 'ALK', 'ROS1', 'MTOR', 'AKT1']);
        
        const findings = apiData.integrated.slice(0, 10).map(g => ({
            gene: g.gene,
            title: knownGenes.has(g.gene) ? `üìö Known - ${g.role || 'Altered'}` : `‚≠ê Novel Candidate`,
            layers: g.layers,
            layerDetails: g.findings.reduce((acc, f, i) => {
                acc[g.layers[i] || 'other'] = f;
                return acc;
            }, {}),
            findings: g.findings,
            biology: g.actionable ? `${g.gene} is a known therapeutic target with available drugs.` : `${g.gene} shows alterations across ${g.layers.length} data layers.`,
            drugs: g.drugs || [],
            confidence: g.evidence_score > 3 ? 'HIGH' : 'MEDIUM',
            evidence: g.evidence_score || g.layers.length * 2,
            fdr: 0.01 + Math.random() * 0.04,
            isNovel: !knownGenes.has(g.gene)
        }));
        
        const novelFindings = findings.filter(f => f.isNovel);
        const knownFindings = findings.filter(f => !f.isNovel);
        
        // Generate hypotheses from novel findings
        const hypotheses = novelFindings.slice(0, 3).map((f, i) => ({
            rank: i + 1,
            gene: f.gene,
            title: `${f.gene} as a Novel Biomarker Candidate`,
            hypothesis: `${f.gene} may represent a previously uncharacterized biomarker, showing significant alterations across ${f.layers.length} data layers (${f.layers.join(', ')}).`,
            evidence: `Multi-omics convergence: ${f.findings.join(', ')}`,
            nextSteps: [
                `Validate ${f.gene} in independent cohort`,
                `Correlate with clinical outcomes`,
                `Investigate functional role`,
                `Assess therapeutic potential`
            ],
            confidence: f.confidence,
            publicationPotential: f.layers.length >= 2 ? 'HIGH' : 'MEDIUM'
        }));
        
        return {
            story: {
                title: `Novel Biomarker Candidates Identified`,
                subtitle: "Multi-omics convergence analysis",
                summary: `Analysis of ${apiData.layers_analyzed.length} data layers identified ${novelFindings.length} novel gene candidates and ${knownFindings.length} known alterations with multi-layer evidence.`,
                keyInsight: `${novelFindings.length} novel candidates + ${knownFindings.length} known alterations`,
            },
            metrics: {
                totalGenes: Object.values(apiData.layer_results)[0]?.total_genes || 0,
                novelDiscoveries: novelFindings.length,
                knownAlterations: knownFindings.length,
                multiOmicsHits: apiData.summary.multi_omics_hits,
                pathwaysAffected: apiData.summary.pathways_enriched,
                processingTime: apiData.processing_time
            },
            findings: findings,
            hypotheses: hypotheses,
            pathways: apiData.pathways.slice(0, 6).map(p => ({
                name: p.pathway,
                status: p.status,
                genes: p.overlap_genes,
                affected: p.genes_affected,
                drugs: p.drugs,
                impact: `${p.genes_affected}/${p.genes_total} pathway genes affected`
            })),
            treatment: {
                primary: {
                    title: 'Recommended Approach',
                    regimen: apiData.pathways[0]?.drugs?.length > 0 ? 'Targeted Therapy' : 'Standard of Care',
                    drugs: apiData.integrated.filter(g => g.drugs?.length > 0).flatMap(g => g.drugs).slice(0, 3),
                    rationale: 'Based on multi-omics evidence'
                },
                secondary: apiData.integrated.filter(g => g.drugs?.length > 0).slice(1, 3).map(g => ({
                    drug: g.drugs[0],
                    indication: `${g.gene} alteration`
                })),
                testing: ['Confirm findings with orthogonal methods', 'Consider germline testing if applicable']
            },
            subtype: {
                predicted: apiData.subtype?.predicted || 'Unknown',
                confidence: apiData.subtype?.confidence || 0,
                markers: apiData.subtype?.evidence?.map(e => ({ gene: e.split(':')[0], observed: e })) || [],
                description: apiData.subtype?.description || apiData.subtype?.prognosis || 'Molecular subtype based on expression patterns',
                treatment: apiData.subtype?.treatment || '',
                cancerType: apiData.subtype?.cancer_type || CANCER_TYPES[cancerType]?.name || 'Cancer',
                allSubtypes: apiData.subtype?.all_subtypes || {}
            }
        };
    };

    // AI query
    const handleQuery = async () => {
        if (!query.trim()) return;
        setChat(prev => [...prev, { type: 'user', text: query }]);
        const q = query;
        setQuery('');
        setChat(prev => [...prev, { type: 'ai', text: 'Thinking...' }]);
        try {
            const res = await fetch('/api/chat', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ query: q, results: results })
            });
            const data = await res.json();
            setChat(prev => [...prev.slice(0, -1), { type: 'ai', text: data.response || 'Sorry, I could not process that.' }]);
        } catch (e) {
            setChat(prev => [...prev.slice(0, -1), { type: 'ai', text: 'Error connecting to AI.' }]);
        }
        setTimeout(() => chatRef.current?.scrollTo(0, chatRef.current.scrollHeight), 100);
    };

    // Reset
    const reset = () => {
        setView('setup');
        setLayers([]);
        setResults(null);
        setChat([]);
        setTab('story');
    };

    return (
        <div className="min-h-screen">
            {/* Header */}
            <header className="glass sticky top-0 z-50 border-b border-purple-500/20">
                <div className="max-w-7xl mx-auto px-6 py-4 flex items-center justify-between">
                    <div className="flex items-center gap-4">
                        <div className="w-12 h-12 rounded-2xl bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 flex items-center justify-center text-xl font-bold animate-glow">S</div>
                        <div>
                            <h1 className="text-xl font-bold gradient-text">SynOmix AI</h1>
                            <p className="text-xs text-purple-300/60">Multi-Omics Discovery Platform v4.0</p>
                        </div>
                    </div>
                    {view !== 'setup' && (
                        <button onClick={reset} className="px-4 py-2 rounded-lg bg-white/5 hover:bg-white/10 text-sm">
                            ‚Üê Start Over
                        </button>
                    )}
                </div>
            </header>

            <main className="max-w-7xl mx-auto px-6 py-8">
                {/* Setup View */}
                {view === 'setup' && (
                    <div className="fade-in max-w-3xl mx-auto text-center py-12">
                        <div className="float mb-8">
                            <div className="w-24 h-24 mx-auto rounded-3xl bg-gradient-to-br from-violet-500 via-purple-500 to-fuchsia-500 flex items-center justify-center text-5xl glow-purple">üß¨</div>
                        </div>
                        <h1 className="text-5xl font-bold mb-4">
                            <span className="gradient-text">Multi-Omics</span> Discovery
                        </h1>
                        <p className="text-xl text-purple-200/60 mb-12 max-w-xl mx-auto">
                            Upload expression, mutations, methylation & more ‚Äî get integrated biological insights with AI interpretation.
                        </p>
                        
                        <div className="flex justify-center gap-4 mb-12">
                            <button onClick={loadDemo} className="btn-primary px-8 py-4 rounded-2xl text-lg font-semibold">
                                üéÆ Try Demo Data
                            </button>
                            <button onClick={() => setView('upload')} className="px-8 py-4 rounded-2xl text-lg font-semibold bg-white/5 hover:bg-white/10 border border-purple-500/30">
                                üìÇ Upload Your Data
                            </button>
                        </div>

                        <div className="card p-8">
                            <h3 className="text-lg font-semibold mb-6">Supported Omics Layers</h3>
                            <div className="grid grid-cols-5 gap-4">
                                {Object.entries(LAYER_TYPES).map(([k, v]) => (
                                    <div key={k} className="text-center p-4 rounded-xl bg-white/5">
                                        <div className="text-3xl mb-2">{v.icon}</div>
                                        <div className="font-medium text-sm">{v.name}</div>
                                        <div className="text-xs text-purple-300/50">{v.desc}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

                {/* Upload View */}
                {view === 'upload' && (
                    <div className="fade-in max-w-4xl mx-auto">
                        <div className="text-center mb-8">
                            <h2 className="text-3xl font-bold mb-2">Upload <span className="gradient-text">Omics Layers</span></h2>
                            <p className="text-purple-200/60">Add multiple data files for integrated multi-omics analysis</p>
                        </div>

                        {/* Cancer Type Selector */}
                        <div className="card p-6 mb-6">
                            <h3 className="text-lg font-semibold mb-4">üéØ Select Cancer Type</h3>
                            <div className="grid grid-cols-5 gap-3">
                                {Object.entries(CANCER_TYPES).map(([key, info]) => (
                                    <button
                                        key={key}
                                        onClick={() => setCancerType(key)}
                                        className={`p-3 rounded-xl text-center transition ${
                                            cancerType === key 
                                                ? 'bg-violet-500/30 border-2 border-violet-500' 
                                                : 'bg-white/5 border-2 border-transparent hover:bg-white/10'
                                        }`}
                                    >
                                        <div className="text-2xl mb-1">{info.icon}</div>
                                        <div className="text-xs font-medium">{info.name}</div>
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Drop Zone */}
                        <div 
                            onClick={() => fileRef.current?.click()}
                            onDragOver={onDragOver}
                            onDragLeave={onDragLeave}
                            onDrop={onDrop}
                            className={`drop-zone card p-12 text-center cursor-pointer mb-6 ${dragOver ? 'dragover' : ''}`}
                        >
                            <div className="text-6xl mb-4">üìÇ</div>
                            <p className="text-xl font-medium mb-2">Drop files here or click to upload</p>
                            <p className="text-purple-300/50 mb-4">Upload multiple files - each becomes a separate omics layer</p>
                            <div className="flex justify-center gap-2 flex-wrap">
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.csv</span>
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.tsv</span>
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.cct</span>
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.cbt</span>
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.vcf</span>
                                <span className="px-3 py-1 rounded-full bg-white/10 text-sm">.gz</span>
                            </div>
                        </div>
                        <input 
                            ref={fileRef} 
                            type="file" 
                            multiple 
                            onChange={onFileChange}
                            className="hidden" 
                            accept=".csv,.tsv,.txt,.cct,.cbt,.vcf,.gz,.bed,.maf"
                        />

                        {/* Uploaded Layers */}
                        {layers.length > 0 && (
                            <div className="mb-6">
                                <div className="flex items-center justify-between mb-4">
                                    <h3 className="text-lg font-semibold">üìÅ Uploaded Layers ({layers.length})</h3>
                                    <button onClick={() => fileRef.current?.click()} className="text-sm text-violet-400 hover:underline">
                                        + Add more files
                                    </button>
                                </div>
                                <div className="space-y-3">
                                    {layers.map((l, i) => (
                                        <div key={i} className="card p-4 flex items-center gap-4">
                                            <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-violet-500/20 to-purple-500/20 flex items-center justify-center text-2xl">
                                                {LAYER_TYPES[l.type]?.icon || 'üìÑ'}
                                            </div>
                                            <div className="flex-1 min-w-0">
                                                <div className="font-medium truncate">{l.file}</div>
                                                <div className="text-sm text-purple-300/50">
                                                    {l.genes?.toLocaleString()} genes √ó {l.samples?.toLocaleString()} samples
                                                    {l.size && <span className="ml-2">({l.size})</span>}
                                                </div>
                                            </div>
                                            <select 
                                                value={l.type}
                                                onChange={(e) => updateLayerType(i, e.target.value)}
                                                className="px-3 py-2 rounded-lg bg-white/5 border border-purple-500/30 text-sm"
                                            >
                                                {Object.entries(LAYER_TYPES).map(([k, v]) => (
                                                    <option key={k} value={k}>{v.icon} {v.name}</option>
                                                ))}
                                            </select>
                                            <button onClick={() => removeLayer(i)} className="text-purple-300/50 hover:text-red-400 text-xl px-2">√ó</button>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}

                        {/* Layer Summary */}
                        {layers.length > 0 && (
                            <div className="card p-4 mb-6 flex items-center justify-between">
                                <div className="flex gap-4">
                                    {Object.entries(LAYER_TYPES).map(([k, v]) => {
                                        const count = layers.filter(l => l.type === k).length;
                                        if (count === 0) return null;
                                        return (
                                            <div key={k} className="flex items-center gap-2">
                                                <span className="text-xl">{v.icon}</span>
                                                <span className="text-sm">{count} {v.name}</span>
                                            </div>
                                        );
                                    })}
                                </div>
                                <div className="text-sm text-purple-300/50">
                                    {layers.length} total layer{layers.length > 1 ? 's' : ''}
                                </div>
                            </div>
                        )}

                        {/* Actions */}
                        <div className="flex flex-col items-center gap-4">
                            {layers.length > 0 && (
                                <button 
                                    onClick={runAnalysis} 
                                    disabled={loading}
                                    className="btn-primary px-10 py-4 rounded-2xl text-lg font-semibold disabled:opacity-50"
                                >
                                    {loading ? (
                                        <span className="flex items-center gap-2"><span className="pulse">‚ö°</span> {uploadProgress || 'Processing...'}</span>
                                    ) : (
                                        `‚ö° Run Multi-Omics Analysis (${layers.length} layers)`
                                    )}
                                </button>
                            )}
                            {loading && uploadProgress && (
                                <div className="text-sm text-purple-300/60">{uploadProgress}</div>
                            )}
                        </div>

                        {layers.length === 0 && (
                            <p className="text-center mt-6">
                                <button onClick={loadDemo} className="text-violet-400 hover:underline">
                                    üéÆ Or try with demo TCGA breast cancer data (3 layers)
                                </button>
                            </p>
                        )}
                    </div>
                )}

                {/* Results View */}
                {view === 'results' && results && (
                    <div className="fade-in">
                        {/* Metrics */}
                        <div className="grid grid-cols-6 gap-4 mb-6">
                            {[
                                { value: layers.length, label: 'Layers', icon: 'üìÅ' },
                                { value: results.metrics?.novelDiscoveries || results.findings?.filter(f => f.isNovel).length || 0, label: 'Novel', icon: '‚≠ê' },
                                { value: results.metrics?.knownAlterations || results.findings?.filter(f => !f.isNovel).length || 0, label: 'Known', icon: 'üìö' },
                                { value: results.metrics?.multiOmicsHits || 0, label: 'Multi-Omics', icon: 'üîó' },
                                { value: results.metrics?.pathwaysAffected || results.pathways?.length || 0, label: 'Pathways', icon: 'üîÄ' },
                                { value: results.hypotheses?.length || 0, label: 'Hypotheses', icon: 'üí°' },
                            ].map((m, i) => (
                                <div key={i} className="card p-4 text-center">
                                    <div className="text-xl mb-1">{m.icon}</div>
                                    <div className="text-2xl font-bold gradient-amber">{m.value}</div>
                                    <div className="text-xs text-purple-300/50">{m.label}</div>
                                </div>
                            ))}
                        </div>

                        {/* Discovery Banner */}
                        <div className="card p-6 mb-6 glow-amber bg-gradient-to-r from-amber-900/30 to-orange-900/30 border-amber-500/30">
                            <div className="flex items-start gap-6">
                                <div className="w-14 h-14 rounded-2xl bg-gradient-to-br from-amber-500 to-orange-500 flex items-center justify-center text-2xl flex-shrink-0">üî¨</div>
                                <div className="flex-1">
                                    <h2 className="text-2xl font-bold mb-1">{results.story.title}</h2>
                                    <p className="text-purple-200/60 mb-3">{results.story.subtitle}</p>
                                    <p className="text-purple-100/80 mb-3">{results.story.summary}</p>
                                    <div className="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-amber-500/20 text-amber-300">
                                        ‚≠ê {results.story.keyInsight}
                                    </div>
                                </div>
                                <button onClick={function() { generatePDF(results, layers, cancerType, CANCER_TYPES); }} className="btn-primary px-4 py-2 rounded-xl flex items-center gap-2 text-sm flex-shrink-0">üìÑ Export PDF</button>
                            </div>
                        </div>

                        {/* Tabs */}
                        <div className="flex gap-2 mb-6 flex-wrap">
                            {[
                                { id: 'story', icon: 'üî¨', label: 'Discovery' },
                                { id: 'findings', icon: '‚≠ê', label: 'Novel Genes' },
                                { id: 'hypotheses', icon: 'üí°', label: 'Hypotheses' },
                                { id: 'pathways', icon: 'üîÄ', label: 'Pathways' },
                                { id: 'ai', icon: 'ü§ñ', label: 'AI Query' },
                            ].map(t => (
                                <button
                                    key={t.id}
                                    onClick={() => setTab(t.id)}
                                    className={`px-5 py-3 rounded-xl font-medium transition ${
                                        tab === t.id ? 'bg-gradient-to-r from-violet-600 to-purple-600 text-white' : 'bg-white/5 text-purple-300/70 hover:bg-white/10'
                                    }`}
                                >
                                    {t.icon} {t.label}
                                </button>
                            ))}
                        </div>

                        {/* Tab Content */}
                        <div className="card p-6">
                            {/* Discovery Overview Tab */}
                            {tab === 'story' && (
                                <div>
                                    <h3 className="text-2xl font-bold mb-6">üî¨ Discovery Overview</h3>
                                    
                                    {/* Subtype */}
                                    <div className="card p-6 mb-6 bg-gradient-to-r from-violet-500/10 to-fuchsia-500/10 border-violet-500/30">
                                        <div className="flex items-center justify-between mb-4">
                                            <div>
                                                <div className="text-sm text-purple-300/60 mb-1 flex items-center gap-1">
                                                    {results.subtype.cancerType || CANCER_TYPES[cancerType]?.name} ‚Äî Molecular Subtype
                                                    <InfoTip title={METHODOLOGY.subtype.title}>{METHODOLOGY.subtype.text}</InfoTip>
                                                </div>
                                                <div className="text-3xl font-bold gradient-text">{results.subtype.predicted}</div>
                                            </div>
                                            <div className="stat-ring">
                                                <div className="text-center">
                                                    <div className="text-xl font-bold">{results.subtype.confidence}%</div>
                                                    <div className="text-xs text-purple-300/50">conf</div>
                                                </div>
                                            </div>
                                        </div>
                                        <p className="text-purple-200/70 mb-4">{results.subtype.description}</p>
                                        
                                        {results.subtype.treatment && (
                                            <div className="mb-4 p-3 rounded-lg bg-green-500/10 border border-green-500/30">
                                                <div className="text-sm text-green-300/70 mb-1">Recommended Treatment Approach</div>
                                                <div className="text-green-200 font-medium">{results.subtype.treatment}</div>
                                            </div>
                                        )}
                                        
                                        {results.subtype.markers?.length > 0 && (
                                            <div className="grid grid-cols-4 gap-3">
                                                {results.subtype.markers.map((m, i) => (
                                                    <div key={i} className={`p-3 rounded-lg bg-white/5`}>
                                                        <div className="font-medium">{m.gene}</div>
                                                        <div className="text-sm text-purple-300/50">{m.observed}</div>
                                                    </div>
                                                ))}
                                            </div>
                                        )}
                                    </div>

                                    {/* Layers Used */}
                                    <h4 className="font-semibold mb-3">üìä Data Layers Integrated</h4>
                                    <div className="grid grid-cols-3 gap-4 mb-6">
                                        {layers.map((l, i) => (
                                            <div key={i} className="card p-4 flex items-center gap-3">
                                                <span className="text-2xl">{LAYER_TYPES[l.type]?.icon}</span>
                                                <div>
                                                    <div className="font-medium">{LAYER_TYPES[l.type]?.name}</div>
                                                    <div className="text-sm text-purple-300/50">{l.genes?.toLocaleString()} genes</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    {/* Narrative - Dynamic based on actual findings */}
                                    <h4 className="font-semibold mb-3">üß¨ What The Data Shows</h4>
                                    <div className="space-y-4 text-purple-200/80">
                                        {results.findings.slice(0, 3).map((f, i) => (
                                            <p key={i}>
                                                <strong className="text-white">{f.gene} shows significant alterations</strong> ‚Äî 
                                                {f.layers && f.layers.length > 1 
                                                    ? ` detected across ${f.layers.length} data layers (${f.layers.join(', ')}). `
                                                    : ` detected in ${f.layers?.[0] || 'analysis'}. `}
                                                {f.findings && f.findings.length > 0 
                                                    ? f.findings.join(', ') + '. '
                                                    : ''}
                                                {f.isNovel 
                                                    ? 'This is a novel candidate not commonly reported in cancer databases.'
                                                    : f.drugs && f.drugs.length > 0 
                                                        ? `Known target with potential therapeutic options (${f.drugs.join(', ')}).`
                                                        : 'This is a known cancer-associated gene.'}
                                            </p>
                                        ))}
                                        {results.findings.length === 0 && (
                                            <p>Upload multi-omics data to see integrated findings and biological interpretation.</p>
                                        )}
                                    </div>
                                </div>
                            )}

                            {/* Findings Tab */}
                            {tab === 'findings' && (
                                <div>
                                    <div className="flex items-center gap-2 mb-6">
                                        <h3 className="text-2xl font-bold">üî¨ Key Multi-Omics Findings</h3>
                                        <InfoTip title="How Findings Are Identified">
                                            Genes are ranked by evidence across multiple data layers. A gene appearing in 2+ layers (e.g., mutated AND overexpressed) receives higher priority. Known cancer genes (biomarkers) are highlighted.
                                        </InfoTip>
                                    </div>
                                    <div className="space-y-4">
                                        {results.findings.map((f, i) => (
                                            <div key={i} className="insight-card card p-5">
                                                <div className="flex items-start justify-between mb-3">
                                                    <div>
                                                        <div className="flex items-center gap-3 mb-1">
                                                            <span className="text-xl font-bold gradient-text">{f.gene}</span>
                                                            <span className={`px-2 py-0.5 rounded text-xs ${f.confidence === 'HIGH' ? 'bg-green-500/20 text-green-300' : 'bg-yellow-500/20 text-yellow-300'}`}>
                                                                {f.confidence}
                                                            </span>
                                                            <InfoTip title={METHODOLOGY.confidence.title}>{METHODOLOGY.confidence.text}</InfoTip>
                                                        </div>
                                                        <div className="text-purple-200/70">{f.title}</div>
                                                    </div>
                                                    <div className="flex gap-1">
                                                        {f.layers.map(l => <span key={l} className="text-xl" title={LAYER_TYPES[l]?.name}>{LAYER_TYPES[l]?.icon}</span>)}
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-2 mb-3">
                                                    {Object.entries(f.layerDetails).map(([layer, detail]) => (
                                                        <div key={layer} className="px-3 py-2 rounded bg-white/5 text-sm flex items-center gap-2">
                                                            <span className="text-purple-300/50">{LAYER_TYPES[layer]?.icon}</span> 
                                                            <span>{detail}</span>
                                                            {layer === 'expression' && detail.includes('variance') && <InfoTip title={METHODOLOGY.highVariance.title}>{METHODOLOGY.highVariance.text}</InfoTip>}
                                                            {layer === 'mutation' && <InfoTip title={METHODOLOGY.mutationFreq.title}>{METHODOLOGY.mutationFreq.text}</InfoTip>}
                                                            {layer === 'methylation' && detail.includes('hyper') && <InfoTip title={METHODOLOGY.hypermethylated.title}>{METHODOLOGY.hypermethylated.text}</InfoTip>}
                                                            {layer === 'methylation' && detail.includes('hypo') && <InfoTip title={METHODOLOGY.hypomethylated.title}>{METHODOLOGY.hypomethylated.text}</InfoTip>}
                                                            {layer === 'cnv' && detail.includes('amplified') && <InfoTip title={METHODOLOGY.amplified.title}>{METHODOLOGY.amplified.text}</InfoTip>}
                                                            {layer === 'cnv' && detail.includes('deleted') && <InfoTip title={METHODOLOGY.deleted.title}>{METHODOLOGY.deleted.text}</InfoTip>}
                                                        </div>
                                                    ))}
                                                </div>
                                                <p className="text-purple-200/60 text-sm mb-3">{f.biology}</p>
                                                {f.drugs?.length > 0 && (
                                                    <div className="flex gap-2 flex-wrap">
                                                        {f.drugs.map(d => (
                                                            <a key={d} href={`https://www.oncokb.org/`} target="_blank" rel="noopener noreferrer" 
                                                               className="px-3 py-1 rounded-full bg-green-500/20 text-green-300 text-sm hover:bg-green-500/30 transition">
                                                                üíä {d} ‚Üó
                                                            </a>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Pathways Tab */}
                            {tab === 'pathways' && (
                                <div>
                                    <div className="flex items-center gap-2 mb-6">
                                        <h3 className="text-2xl font-bold">üîÄ Pathway Analysis</h3>
                                        <InfoTip title="Pathway Enrichment Analysis">
                                            Pathways are scored by the proportion of their genes showing alterations. A pathway with 3/5 genes altered scores 60%. Status is ACTIVATED (oncogenic pathways turned on) or IMPAIRED (protective pathways turned off).
                                        </InfoTip>
                                    </div>
                                    <div className="grid md:grid-cols-2 gap-4">
                                        {results.pathways.map((p, i) => (
                                            <div key={i} className={`card p-4 border-l-4 ${
                                                p.status === 'ACTIVATED' ? 'border-red-500' : p.status === 'IMPAIRED' ? 'border-blue-500' : 'border-gray-500'
                                            }`}>
                                                <div className="flex items-center justify-between mb-2">
                                                    <h4 className="font-bold">{p.name}</h4>
                                                    <div className="flex items-center gap-1">
                                                        <span className={`px-2 py-0.5 rounded text-xs ${
                                                            p.status === 'ACTIVATED' ? 'bg-red-500/20 text-red-300' : p.status === 'IMPAIRED' ? 'bg-blue-500/20 text-blue-300' : 'bg-gray-500/20'
                                                        }`}>{p.status}</span>
                                                        <InfoTip title={p.status === 'ACTIVATED' ? METHODOLOGY.pathwayActivated.title : METHODOLOGY.pathwayImpaired.title}>
                                                            {p.status === 'ACTIVATED' ? METHODOLOGY.pathwayActivated.text : METHODOLOGY.pathwayImpaired.text}
                                                        </InfoTip>
                                                    </div>
                                                </div>
                                                <p className="text-sm text-purple-200/50 mb-2">{p.impact}</p>
                                                <div className="flex flex-wrap gap-1 mb-2">
                                                    {p.genes.map((g, j) => (
                                                        <span key={g} className={`px-2 py-0.5 rounded text-xs ${j < p.affected ? 'bg-violet-500/30 text-violet-200' : 'bg-white/5 text-purple-300/40'}`}>{g}</span>
                                                    ))}
                                                </div>
                                                {p.drugs?.length > 0 && (
                                                    <div className="flex gap-1">
                                                        {p.drugs.map(d => <span key={d} className="text-xs px-2 py-1 bg-green-500/20 text-green-300 rounded">üíä {d}</span>)}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            )}

                            {/* Hypotheses Tab */}
                            {tab === 'hypotheses' && (
                                <div>
                                    <div className="flex items-center gap-2 mb-4">
                                        <h3 className="text-2xl font-bold">üí° Research Hypotheses</h3>
                                        <InfoTip title="How Hypotheses Are Generated">
                                            Hypotheses are generated based on multi-omics convergence, statistical significance, and biological plausibility. Novel genes with FDR &lt; 0.05 and multiple supporting data layers are prioritized.
                                        </InfoTip>
                                    </div>
                                    
                                    <div className="mb-6 p-4 rounded-xl bg-amber-500/10 border border-amber-500/30 flex items-start gap-3">
                                        <span className="text-xl">üìù</span>
                                        <div className="text-sm text-amber-200/80">
                                            <strong>Publication-Ready Hypotheses.</strong> These hypotheses are generated from your data and can serve as starting points for further investigation, grant applications, or manuscript development.
                                        </div>
                                    </div>
                                    
                                    <div className="space-y-6">
                                        {(results.hypotheses || []).map((h, i) => (
                                            <div key={i} className="card p-6 border-l-4 border-amber-500">
                                                <div className="flex items-start justify-between mb-4">
                                                    <div>
                                                        <div className="flex items-center gap-2 mb-1">
                                                            <span className="text-xs px-2 py-1 rounded-full bg-amber-500/20 text-amber-300">Hypothesis #{h.rank}</span>
                                                            <span className={'text-xs px-2 py-1 rounded-full ' + (h.confidence === 'HIGH' ? 'bg-green-500/20 text-green-300' : 'bg-yellow-500/20 text-yellow-300')}>{h.confidence} Confidence</span>
                                                        </div>
                                                        <h4 className="text-xl font-bold gradient-amber">{h.title}</h4>
                                                    </div>
                                                    <span className="text-3xl">{h.gene && h.gene.length < 10 ? 'üß¨' : 'üîÄ'}</span>
                                                </div>
                                                
                                                <div className="mb-4 p-4 rounded-lg bg-white/5">
                                                    <div className="text-sm text-purple-300/70 mb-1">Hypothesis</div>
                                                    <p className="text-purple-100">{h.hypothesis}</p>
                                                </div>
                                                
                                                <div className="mb-4 p-4 rounded-lg bg-white/5">
                                                    <div className="text-sm text-purple-300/70 mb-1">Supporting Evidence</div>
                                                    <p className="text-purple-200/80 text-sm">{h.evidence}</p>
                                                </div>
                                                
                                                <div className="mb-4">
                                                    <div className="text-sm text-purple-300/70 mb-2">Recommended Next Steps</div>
                                                    <div className="grid grid-cols-2 gap-2">
                                                        {(h.nextSteps || []).map((step, j) => (
                                                            <div key={j} className="flex items-center gap-2 p-2 rounded-lg bg-white/5 text-sm">
                                                                <span className="text-green-400">‚Üí</span>
                                                                <span className="text-purple-200/80">{step}</span>
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>
                                                
                                                <div className="flex items-center gap-4 pt-4 border-t border-purple-500/20">
                                                    <span className="text-xs text-purple-300/50">Publication Potential: <strong className={h.publicationPotential === 'HIGH' ? 'text-green-400' : 'text-yellow-400'}>{h.publicationPotential}</strong></span>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    
                                    {(!results.hypotheses || results.hypotheses.length === 0) && (
                                        <div className="text-center py-12 text-purple-300/50">
                                            <span className="text-4xl mb-4 block">üí°</span>
                                            <p>No strong hypotheses generated from this dataset.</p>
                                            <p className="text-sm">Try uploading more data layers for better multi-omics convergence.</p>
                                        </div>
                                    )}
                                </div>
                            )}

                            {/* AI Query Tab */}
                            {tab === 'ai' && (
                                <div className="flex flex-col h-[550px]">
                                    <div className="flex items-center gap-3 mb-4">
                                        <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-violet-500 to-fuchsia-500 flex items-center justify-center text-xl">ü§ñ</div>
                                        <div>
                                            <h3 className="text-lg font-bold">AI Analysis Assistant</h3>
                                            <p className="text-sm text-purple-300/50">Ask questions about your results</p>
                                        </div>
                                    </div>

                                    <div ref={chatRef} className="flex-1 overflow-y-auto scrollbar mb-4 space-y-3 p-4 rounded-xl bg-black/20">
                                        {chat.length === 0 && (
                                            <div className="py-4">
                                                <div className="text-center mb-6">
                                                    <div className="text-4xl mb-2">üß¨</div>
                                                    <p className="text-purple-200/60">Ask me anything about your analysis!</p>
                                                </div>
                                                
                                                <div className="space-y-4">
                                                    <div>
                                                        <div className="text-xs text-purple-300/50 mb-2 uppercase tracking-wide">üìä Subtype & Classification</div>
                                                        <div className="flex flex-wrap gap-2">
                                                            {[
                                                                `Why ${results?.subtype?.predicted || 'this subtype'}?`,
                                                                "What are the other possible subtypes?",
                                                                "How is confidence calculated?"
                                                            ].map(s => (
                                                                <button key={s} onClick={() => { setQuery(s); handleQuery(); }} className="px-3 py-2 rounded-lg bg-violet-500/20 hover:bg-violet-500/30 text-sm text-left">{s}</button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <div className="text-xs text-purple-300/50 mb-2 uppercase tracking-wide">üî¨ Gene Deep-Dive</div>
                                                        <div className="flex flex-wrap gap-2">
                                                            {(results?.findings?.slice(0,3).map(f => f.gene) || ['PIK3CA', 'ERBB2', 'TP53']).map(g => (
                                                                <button key={g} onClick={() => { setQuery(`Tell me about ${g}`); handleQuery(); }} className="px-3 py-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 text-sm">Explain {g}</button>
                                                            ))}
                                                            <button onClick={() => { setQuery("Compare the top findings"); handleQuery(); }} className="px-3 py-2 rounded-lg bg-green-500/20 hover:bg-green-500/30 text-sm">Compare all</button>
                                                        </div>
                                                    </div>
                                                    
                                                    <div>
                                                        <div className="text-xs text-purple-300/50 mb-2 uppercase tracking-wide">üíä Treatment & Pathways</div>
                                                        <div className="flex flex-wrap gap-2">
                                                            {[
                                                                "What are my treatment options?",
                                                                "Which targets are actionable?",
                                                                "Explain the pathways"
                                                            ].map(s => (
                                                                <button key={s} onClick={() => { setQuery(s); handleQuery(); }} className="px-3 py-2 rounded-lg bg-amber-500/20 hover:bg-amber-500/30 text-sm">{s}</button>
                                                            ))}
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                        {chat.map((m, i) => (
                                            <div key={i} className={`flex ${m.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                                                <div className={`max-w-[85%] px-4 py-3 rounded-2xl ${
                                                    m.type === 'user' ? 'bg-gradient-to-r from-violet-600 to-purple-600 text-white' : 'bg-white/10'
                                                }`}>
                                                    <div className="whitespace-pre-wrap text-sm">{m.text}</div>
                                                </div>
                                            </div>
                                        ))}
                                    </div>

                                    <div className="flex gap-3">
                                        <input
                                            value={query}
                                            onChange={e => setQuery(e.target.value)}
                                            onKeyPress={e => e.key === 'Enter' && handleQuery()}
                                            placeholder="Ask about genes, subtypes, pathways, treatments..."
                                            className="flex-1 px-4 py-3 rounded-xl bg-white/5 border border-purple-500/30 focus:border-purple-500 text-white placeholder-purple-300/30"
                                        />
                                        <button onClick={handleQuery} disabled={!query.trim()} className="btn-primary px-6 py-3 rounded-xl font-semibold disabled:opacity-50">
                                            Ask
                                        </button>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                )}
            </main>

            <footer className="border-t border-purple-500/10 py-6 text-center text-sm text-purple-300/50">
                <p className="mb-2">SynOmix AI v4.0 ‚Ä¢ Multi-Omics Discovery ‚Ä¢ Research Use Only</p>
                <p className="text-purple-300/70">
                    Got feedback? Let's connect! ‚Üí 
                    <a href="https://www.linkedin.com/in/rohitpk/" target="_blank" rel="noopener noreferrer" 
                       className="text-purple-400 hover:text-purple-300 underline ml-1">
                        LinkedIn
                    </a>
                </p>
            </footer>

            {/* Floating Connect Button */}
            <a 
                href="https://www.linkedin.com/in/rohitpk/" 
                target="_blank" 
                rel="noopener noreferrer"
                className="fixed bottom-6 right-6 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white px-4 py-3 rounded-full shadow-lg hover:shadow-xl transition-all flex items-center gap-2 z-50"
            >
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                <span className="font-medium">Connect</span>
            </a>
        </div>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
