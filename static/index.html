<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SynOmix AI - Multi-Omics Discovery Platform</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Space Grotesk', sans-serif; box-sizing: border-box; }
        body { background: #030712; min-height: 100vh; color: #f1f5f9; }
        body::before {
            content: ''; position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: radial-gradient(ellipse at 20% 20%, rgba(6, 182, 212, 0.08) 0%, transparent 50%),
                        radial-gradient(ellipse at 80% 80%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
            pointer-events: none; z-index: 0;
        }
        .sidebar { background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-right: 1px solid rgba(148, 163, 184, 0.1); transition: all 0.3s; }
        .sidebar-collapsed { width: 72px; }
        .sidebar-expanded { width: 260px; }
        .nav-item { display: flex; align-items: center; gap: 12px; padding: 12px 16px; border-radius: 12px; transition: all 0.2s; cursor: pointer; color: #94a3b8; }
        .nav-item:hover { background: rgba(6, 182, 212, 0.1); color: #f1f5f9; }
        .nav-item.active { background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(139, 92, 246, 0.2)); color: #06b6d4; border: 1px solid rgba(6, 182, 212, 0.3); }
        .card { background: rgba(15, 23, 42, 0.8); backdrop-filter: blur(10px); border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 16px; transition: all 0.3s; }
        .card:hover { border-color: rgba(6, 182, 212, 0.3); transform: translateY(-2px); }
        .btn-primary { background: linear-gradient(135deg, #06b6d4, #8b5cf6); color: white; font-weight: 600; border: none; border-radius: 12px; padding: 12px 24px; cursor: pointer; transition: all 0.3s; }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 40px rgba(6, 182, 212, 0.4); }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-secondary { background: rgba(148, 163, 184, 0.1); color: #f1f5f9; font-weight: 500; border: 1px solid rgba(148, 163, 184, 0.1); border-radius: 12px; padding: 12px 24px; cursor: pointer; }
        .gradient-text { background: linear-gradient(135deg, #06b6d4, #8b5cf6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes glow { 0%, 100% { box-shadow: 0 0 20px rgba(6, 182, 212, 0.3); } 50% { box-shadow: 0 0 40px rgba(6, 182, 212, 0.5); } }
        .fade-in { animation: fadeInUp 0.5s ease-out; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-glow { animation: glow 2s infinite; }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-thumb { background: rgba(6, 182, 212, 0.3); border-radius: 3px; }
        .drop-zone { border: 2px dashed rgba(6, 182, 212, 0.3); border-radius: 16px; transition: all 0.3s; }
        .drop-zone:hover, .drop-zone.dragover { border-color: #06b6d4; background: rgba(6, 182, 212, 0.05); }
        .stat-card { position: relative; overflow: hidden; }
        .stat-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px; background: linear-gradient(90deg, #06b6d4, #8b5cf6); }
        .tab-pill { padding: 10px 20px; border-radius: 10px; font-weight: 500; transition: all 0.2s; cursor: pointer; color: #94a3b8; background: transparent; border: none; }
        .tab-pill:hover { background: rgba(148, 163, 184, 0.1); color: #f1f5f9; }
        .tab-pill.active { background: linear-gradient(135deg, #06b6d4, #8b5cf6); color: white; }
        .bar-chart { display: flex; align-items: end; gap: 8px; height: 200px; padding: 20px 0; }
        .bar { background: linear-gradient(to top, #06b6d4, #8b5cf6); border-radius: 4px 4px 0 0; min-width: 40px; transition: all 0.3s; }
        .bar:hover { opacity: 0.8; }
        @media (max-width: 768px) {
            .sidebar { position: fixed; z-index: 100; height: 100vh; }
            .sidebar-collapsed { transform: translateX(-100%); }
        }
    </style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useRef, useEffect } = React;

const LAYER_TYPES = {
    expression: { icon: 'üß¨', name: 'Gene Expression', color: '#06b6d4' },
    mutation: { icon: 'üî¨', name: 'Mutations', color: '#f43f5e' },
    methylation: { icon: 'üîµ', name: 'Methylation', color: '#3b82f6' },
    cnv: { icon: 'üìä', name: 'Copy Number', color: '#f59e0b' },
    protein: { icon: 'üî∑', name: 'Proteomics', color: '#8b5cf6' },
};


const CANCER_TYPES = {
    breast: { name: "Breast Cancer", icon: "üéÄ" },
    lung: { name: "Lung Cancer", icon: "ü´Å" },
    colorectal: { name: "Colorectal", icon: "üî¥" },
    prostate: { name: "Prostate", icon: "üîµ" },
    ovarian: { name: "Ovarian", icon: "üü£" },
    melanoma: { name: "Melanoma", icon: "üü§" },
    glioma: { name: "Glioma", icon: "üß†" },
    pancreatic: { name: "Pancreatic", icon: "üü°" },
    liver: { name: "Liver", icon: "üü†" },
    gastric: { name: "Gastric", icon: "‚≠ï" },
};


const DEMO = {
    layers: [
        { type: 'expression', file: 'TCGA_BRCA_RNAseq.cct', genes: 20155, samples: 1093 },
        { type: 'mutation', file: 'TCGA_BRCA_mutations.cbt', genes: 7966, samples: 975 },
        { type: 'methylation', file: 'TCGA_BRCA_methylation.cct', genes: 20106, samples: 783 },
    ],
    results: {
        story: { title: "Novel Biomarker Candidates Identified", subtitle: "Multi-omics convergence reveals new targets", summary: "Analysis identified 8 novel gene candidates with significant multi-omics convergence.", keyInsight: "8 novel + 4 known alterations" },
        metrics: { totalGenes: 20155, novelDiscoveries: 8, knownAlterations: 4, multiOmicsHits: 12, pathwaysAffected: 6 },
        findings: [
            { gene: 'SFRP1', title: '‚≠ê Novel - Epigenetically Silenced', layers: ['expression', 'methylation'], layerDetails: { expression: '3.2x downregulated', methylation: 'Promoter hypermethylated' }, biology: 'SFRP1 silencing may activate Wnt signaling.', drugs: [], confidence: 'HIGH', evidence: 9, isNovel: true },
            { gene: 'ADAMTS5', title: '‚≠ê Novel - Amplified', layers: ['expression', 'cnv'], layerDetails: { expression: '2.8x overexpressed', cnv: 'Copy number gain' }, biology: 'May promote ECM remodeling and invasion.', drugs: [], confidence: 'HIGH', evidence: 8, isNovel: true },
            { gene: 'PIK3CA', title: 'üìö Known - Double-Hit', layers: ['expression', 'mutation'], layerDetails: { expression: '3.8x overexpressed', mutation: 'H1047R hotspot (34%)' }, biology: 'Hyperactivates PI3K-AKT pathway.', drugs: ['Alpelisib'], confidence: 'HIGH', evidence: 8, isNovel: false },
            { gene: 'TP53', title: 'üìö Known - Lost TSG', layers: ['expression', 'mutation'], layerDetails: { expression: '0.4x decreased', mutation: 'R248W (33%)' }, biology: 'Loss of tumor suppressor.', drugs: [], confidence: 'HIGH', evidence: 7, isNovel: false },
            { gene: 'ERBB2', title: 'üìö Known - Amplified', layers: ['expression', 'cnv'], layerDetails: { expression: '8.2x overexpressed', cnv: 'Amplified' }, biology: 'Classic HER2 amplification.', drugs: ['Trastuzumab'], confidence: 'HIGH', evidence: 9, isNovel: false },
        ],
        hypotheses: [
            { rank: 1, gene: 'SFRP1', title: 'SFRP1 as Novel Biomarker', hypothesis: 'SFRP1 silencing may activate Wnt pathway.', evidence: 'Multi-omics convergence', nextSteps: ['Validate in cohort', 'Survival analysis'], confidence: 'HIGH', publicationPotential: 'HIGH' },
        ],
        pathways: [
            { name: 'Wnt Signaling', status: 'ACTIVATED', genes: ['SFRP1', 'CTNNB1', 'APC'], affected: 2, drugs: [], impact: '‚≠ê Novel finding' },
            { name: 'PI3K-AKT-mTOR', status: 'ACTIVATED', genes: ['PIK3CA', 'AKT1', 'MTOR'], affected: 3, drugs: ['Alpelisib', 'Everolimus'], impact: 'Known driver' },
            { name: 'p53 Pathway', status: 'IMPAIRED', genes: ['TP53', 'MDM2'], affected: 2, drugs: [], impact: 'Lost checkpoint' },
        ],
        subtype: { predicted: 'HER2-enriched', confidence: 94, description: 'HER2-driven, responds to targeted therapy' }
    }
};


const generatePDF = (results, layers) => {
    const pdf = new window.jspdf.jsPDF();
    pdf.setFillColor(6, 182, 212);
    pdf.rect(0, 0, 220, 35, 'F');
    pdf.setTextColor(255, 255, 255);
    pdf.setFontSize(22);
    pdf.text('SynOmix AI Report', 20, 22);
    pdf.setFontSize(10);
    pdf.text(new Date().toLocaleDateString(), 170, 22);
    let y = 50;
    pdf.setTextColor(100, 100, 100);
    pdf.setFontSize(12);
    pdf.text('Layers: ' + layers.length, 20, y);
    pdf.text('Novel: ' + (results.metrics?.novelDiscoveries || 0), 20, y + 10);
    y = 80;
    pdf.setTextColor(6, 182, 212);
    pdf.setFontSize(14);
    pdf.text('TOP FINDINGS', 20, y);
    y += 12;
    pdf.setTextColor(60, 60, 60);
    pdf.setFontSize(10);
    results.findings?.slice(0, 5).forEach((f, i) => { pdf.text((i+1) + '. ' + f.gene + ' - ' + f.title, 20, y); y += 8; });
    pdf.setFontSize(8);
    pdf.setTextColor(150);
    pdf.text('FOR RESEARCH USE ONLY', 20, 280);
    pdf.save('SynOmix_Report.pdf');
};


const detectLayerType = (filename) => {
    const f = filename.toLowerCase().replace(".gz", "");
    // CNV - check FIRST (before expression, since SCNA contains "rna")
    if (f.includes("cnv") || f.includes("scna") || f.includes("gistic") || f.includes("copy") || f.includes("snp_6")) return "cnv";
    // Methylation - check BEFORE expression
    if (f.includes("methyl") || f.includes("meth450") || f.includes("meth27")) return "methylation";
    // Mutations
    if (f.includes("mutation") || f.includes("mutsig") || f.includes("maf") || f.includes("snv") || f.endsWith(".vcf") || f.endsWith(".cbt")) return "mutation";
    // Proteomics
    if (f.includes("rppa") || f.includes("protein") || f.includes("proteom")) return "protein";
    // Expression - check LAST (most generic)
    if (f.includes("rnaseq") || f.includes("rna_") || f.includes("_rna") || f.includes("expression") || f.includes("rsem") || f.includes("rpkm") || f.includes("fpkm") || f.includes("tpm") || f.endsWith(".cct")) return "expression";
    return "expression";
};


const Icons = {
    Menu: () => <svg className="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>,
    Home: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6" /></svg>,
    Upload: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12" /></svg>,
    Chart: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z" /></svg>,
    Dna: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v6.072a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" /></svg>,
    Brain: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>,
    Pathway: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M13 10V3L4 14h7v7l9-11h-7z" /></svg>,
    ChevronRight: () => <svg className="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 5l7 7-7 7" /></svg>,
    X: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M6 18L18 6M6 6l12 12" /></svg>,
    Download: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>,
    Lightbulb: () => <svg className="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z" /></svg>,
};

const SimpleBarChart = ({ data }) => {
    const maxVal = Math.max(...data.map(d => d.value), 1);
    const yTicks = [0, Math.ceil(maxVal/2), maxVal];
    return (
        <div className="relative" style={{ height: "240px" }}>
            {/* Y-axis */}
            <div className="absolute left-0 top-0 bottom-8 w-8 flex flex-col justify-between text-xs text-slate-400">
                {yTicks.reverse().map((tick, i) => (
                    <span key={i} className="text-right pr-2">{tick}</span>
                ))}
            </div>
            {/* Y-axis label */}
            <div className="absolute -left-2 top-1/2 -translate-y-1/2 -rotate-90 text-xs text-slate-500 whitespace-nowrap">Evidence Score</div>
            {/* Chart area */}
            <div className="ml-10 h-full flex flex-col">
                {/* Bars */}
                <div className="flex-1 flex items-end gap-3 border-l border-b border-slate-600 pl-2 pb-2 relative">
                    {/* Grid lines */}
                    <div className="absolute inset-0 flex flex-col justify-between pointer-events-none">
                        {[0,1,2].map(i => <div key={i} className="border-t border-slate-700/50 w-full"></div>)}
                    </div>
                    {/* Bars */}
                    {data.map((d, i) => (
                        <div key={i} className="flex flex-col items-center gap-1 flex-1 z-10">
                            <div 
                                className="w-full max-w-12 rounded-t-md transition-all duration-300 hover:opacity-80 cursor-pointer relative group"
                                style={{ 
                                    height: `${Math.max((d.value / maxVal) * 150, 4)}px`,
                                    background: d.isNovel ? "linear-gradient(to top, #f59e0b, #fbbf24)" : "linear-gradient(to top, #06b6d4, #8b5cf6)"
                                }}
                            >
                                {/* Tooltip */}
                                <div className="absolute -top-8 left-1/2 -translate-x-1/2 bg-slate-800 px-2 py-1 rounded text-xs whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity border border-slate-600">
                                    {d.name}: {d.value}
                                </div>
                            </div>
                        </div>
                    ))}
                </div>
                {/* X-axis labels */}
                <div className="flex gap-3 pl-2 pt-2">
                    {data.map((d, i) => (
                        <div key={i} className="flex-1 text-center">
                            <span className="text-xs text-slate-400 font-medium">{d.name}</span>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
};


function App() {
    const [sidebarOpen, setSidebarOpen] = useState(true);
    const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
    const [currentPage, setCurrentPage] = useState('home');
    const [layers, setLayers] = useState([]);
    const [results, setResults] = useState(null);
    const [loading, setLoading] = useState(false);
    const [cancerType, setCancerType] = useState('breast');
    const [tab, setTab] = useState('all');
    const [query, setQuery] = useState('');
    const [chat, setChat] = useState([]);
    const [isMobile, setIsMobile] = useState(false);
    const fileRef = useRef();
    const chatRef = useRef();
    const queryRef = useRef();

    useEffect(() => {
        const checkMobile = () => setIsMobile(window.innerWidth < 768);
        checkMobile();
        window.addEventListener('resize', checkMobile);
        return () => window.removeEventListener('resize', checkMobile);
    }, []);

    const navItems = [
        { id: 'home', icon: Icons.Home, label: 'Dashboard' },
        { id: 'upload', icon: Icons.Upload, label: 'Upload Data' },
        { id: 'results', icon: Icons.Chart, label: 'Results', disabled: !results },
        { id: 'genes', icon: Icons.Dna, label: 'Genes', disabled: !results },
        { id: 'pathways', icon: Icons.Pathway, label: 'Pathways', disabled: !results },
        { id: "hypotheses", icon: Icons.Lightbulb, label: "Hypotheses", disabled: !results },
        { id: 'ai', icon: Icons.Brain, label: 'AI Assistant', disabled: !results },
    ];

    const handleFiles = (files) => {
        const newLayers = Array.from(files).map(file => ({
            file, name: file.name, type: detectLayerType(file.name),
            size: (file.size / 1024 / 1024).toFixed(2) + ' MB',
            genes: Math.floor(Math.random() * 15000) + 5000,
        }));
        setLayers([...layers, ...newLayers]);
    };

    const loadDemo = () => { setLayers(DEMO.layers); setResults(DEMO.results); setCurrentPage('results'); };

    const runAnalysis = async () => {
        if (layers.length === 0) return;
        setLoading(true);
        try {
            // Check if using demo data (no actual files)
            const hasRealFiles = layers.some(l => l.file instanceof File);
            
            if (!hasRealFiles) {
                // Demo mode - use demo results
                await new Promise(r => setTimeout(r, 1500));
                setResults(DEMO.results);
                setCurrentPage("results");
                setLoading(false);
                return;
            }
            
            // Real files - call API
            const createRes = await fetch("/api/experiment/create", {
                method: "POST",
                headers: { "Content-Type": "application/x-www-form-urlencoded" },
                body: "name=Analysis&cancer_type=" + cancerType
            });
            const createData = await createRes.json();
            const expId = createData.experiment_id;
            
            // Upload each layer
            for (const layer of layers) {
                if (layer.file instanceof File) {
                    const formData = new FormData();
                    formData.append("file", layer.file);
                    formData.append("layer_type", layer.type);
                    await fetch("/api/experiment/" + expId + "/upload", {
                        method: "POST",
                        body: formData
                    });
                }
            }
            
            // Run analysis
            const analyzeRes = await fetch("/api/experiment/" + expId + "/analyze", { method: "POST" });
            const data = await analyzeRes.json();
            
            // Transform API response to frontend format
            const transformedResults = {
                story: {
                    title: "Analysis Complete: " + (data.summary?.predicted_subtype || "Multi-Omics Results"),
                    subtitle: "Analyzed " + data.layers_analyzed?.length + " data layers",
                    summary: "Found " + (data.summary?.multi_omics_hits || 0) + " multi-omics hits and " + (data.summary?.actionable_targets || 0) + " actionable targets.",
                    keyInsight: (data.summary?.multi_omics_hits || 0) + " hits, " + (data.summary?.pathways_enriched || 0) + " pathways"
                },
                metrics: {
                    totalGenes: data.layer_results?.expression?.total_genes || 0,
                    novelDiscoveries: data.integrated?.filter(g => !g.is_biomarker).length || 0,
                    knownAlterations: data.integrated?.filter(g => g.is_biomarker).length || 0,
                    multiOmicsHits: data.summary?.multi_omics_hits || 0,
                    pathwaysAffected: data.summary?.pathways_enriched || 0
                },
                findings: (data.integrated || []).map(g => ({
                    gene: g.gene,
                    title: g.is_biomarker ? "üìö Known - " + (g.role || "Biomarker") : "‚≠ê Novel Candidate",
                    layers: g.layers || [],
                    layerDetails: g.findings?.reduce((acc, f, i) => { acc[g.layers?.[i] || "data"] = f; return acc; }, {}) || {},
                    biology: g.role ? g.role + ". " + g.findings?.join(", ") : g.findings?.join(", ") || "Multi-omics evidence",
                    drugs: g.drugs || [],
                    confidence: g.evidence_score >= 4 ? "HIGH" : "MEDIUM",
                    evidence: g.evidence_score || 0,
                    isNovel: !g.is_biomarker
                })),
                pathways: (data.pathways || []).map(p => ({
                    name: p.pathway,
                    status: p.status || "ALTERED",
                    genes: p.overlap_genes || [],
                    affected: p.genes_affected || 0,
                    drugs: p.drugs || [],
                    impact: p.genes_affected + "/" + p.genes_total + " genes affected"
                })),
                subtype: {
                    predicted: data.subtype?.predicted || "Unknown",
                    confidence: data.subtype?.confidence || 50,
                    description: data.subtype?.description || "Analysis complete"
                },
                deconvolution: data.layer_results?.deconvolution || null,
                hypotheses: (data.integrated || []).slice(0, 3).map((g, i) => ({
                    rank: i + 1,
                    gene: g.gene,
                    title: g.gene + " as potential biomarker",
                    hypothesis: g.role ? g.role + " - warrants further investigation" : "Shows multi-omics convergence",
                    evidence: g.findings?.join(", ") || "Multiple data layers",
                    nextSteps: ["Validate in independent cohort", "Functional studies"],
                    confidence: g.evidence_score >= 4 ? "HIGH" : "MEDIUM",
                    publicationPotential: g.evidence_score >= 4 ? "HIGH" : "MEDIUM"
                }))
            };
            
            setResults(transformedResults);
            setCurrentPage("results");
        } catch (e) {
            console.error("Analysis failed:", e);
            alert("Analysis failed: " + e.message);
        }
        setLoading(false);
    };

    const handleQuery = async () => {
        const q = queryRef.current?.value || "";
        if (!q.trim()) return;
        setChat(prev => [...prev, { type: "user", text: q }]);
        queryRef.current.value = "";
        setChat(prev => [...prev, { type: "ai", text: "" }]);
        try {
            const res = await fetch("/api/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ query: q, results: results })
            });
            const reader = res.body.getReader();
            const decoder = new TextDecoder();
            let fullText = "";
            while (true) {
                const { done, value } = await reader.read();
                if (done) break;
                const chunk = decoder.decode(value);
                const lines = chunk.split("\n");
                for (const line of lines) {
                    if (line.startsWith("data: ") && !line.includes("[DONE]")) {
                        const text = line.slice(6);
                        fullText += text;
                        setChat(prev => [...prev.slice(0, -1), { type: "ai", text: fullText }]);
                    }
                }
            }
            if (!fullText) setChat(prev => [...prev.slice(0, -1), { type: "ai", text: "Sorry, could not process." }]);
        } catch (e) {
            setChat(prev => [...prev.slice(0, -1), { type: "ai", text: "Error connecting to AI." }]);
        }
        setTimeout(() => chatRef.current?.scrollTo(0, chatRef.current.scrollHeight), 100);
    };

    const Sidebar = () => (
        <aside className={`sidebar fixed left-0 top-0 h-screen flex flex-col z-50 ${isMobile ? (mobileMenuOpen ? 'sidebar-expanded' : 'sidebar-collapsed') : (sidebarOpen ? 'sidebar-expanded' : 'sidebar-collapsed')}`}>
            <div className="p-4 flex items-center gap-3 border-b border-slate-700/50">
                <div className="w-10 h-10 rounded-xl bg-gradient-to-br from-cyan-500 to-violet-500 flex items-center justify-center text-white font-bold animate-glow">S</div>
                {(sidebarOpen || mobileMenuOpen) && <div><div className="font-bold text-white">SynOmix AI</div><div className="text-xs text-slate-400">v6.0</div></div>}
            </div>
            <nav className="flex-1 p-3 space-y-1">
                {navItems.map(item => (
                    <button key={item.id} onClick={() => { setCurrentPage(item.id); setMobileMenuOpen(false); }} disabled={item.disabled}
                        className={`nav-item w-full ${currentPage === item.id ? 'active' : ''} ${item.disabled ? 'opacity-40 cursor-not-allowed' : ''}`}>
                        <item.icon />{(sidebarOpen || mobileMenuOpen) && <span>{item.label}</span>}
                    </button>
                ))}
            </nav>
            {!isMobile && (
                <button onClick={() => setSidebarOpen(!sidebarOpen)} className="p-4 border-t border-slate-700/50 text-slate-400 hover:text-white flex items-center gap-2">
                    <div className={`transition-transform ${sidebarOpen ? 'rotate-180' : ''}`}><Icons.ChevronRight /></div>
                    {sidebarOpen && <span>Collapse</span>}
                </button>
            )}
        </aside>
    );

    const MobileHeader = () => (
        <header className="md:hidden fixed top-0 left-0 right-0 h-16 bg-slate-900/95 backdrop-blur border-b border-slate-700/50 flex items-center justify-between px-4 z-40">
            <button onClick={() => setMobileMenuOpen(!mobileMenuOpen)} className="p-2 text-white">{mobileMenuOpen ? <Icons.X /> : <Icons.Menu />}</button>
            <div className="flex items-center gap-2">
                <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-violet-500 flex items-center justify-center text-white font-bold text-sm">S</div>
                <span className="font-bold text-white">SynOmix</span>
            </div>
            <div className="w-10" />
        </header>
    );

    const HomePage = () => (
        <div className="fade-in space-y-8">
            <div className="text-center py-12">
                <div className="w-24 h-24 mx-auto mb-6 rounded-3xl bg-gradient-to-br from-cyan-500 to-violet-500 flex items-center justify-center text-5xl animate-float">üß¨</div>
                <h1 className="text-5xl font-bold mb-4"><span className="gradient-text">Multi-Omics</span> Discovery</h1>
                <p className="text-xl text-slate-400 max-w-2xl mx-auto mb-8">Upload expression, mutations, methylation & more ‚Äî get integrated biological insights with AI interpretation.</p>
                <div className="flex justify-center gap-4 flex-wrap">
                    <button onClick={loadDemo} className="btn-primary text-lg px-8 py-4">üéÆ Try Demo Data</button>
                    <button onClick={() => setCurrentPage('upload')} className="btn-secondary text-lg px-8 py-4">üìÅ Upload Files</button>
                </div>
            </div>
            <div className="grid md:grid-cols-3 gap-6">
                {[{ icon: 'üî¨', title: 'Multi-Layer Analysis', desc: 'Integrate expression, mutations, methylation, and CNV data' },
                  { icon: '‚≠ê', title: 'Novel Discovery', desc: 'Identify novel biomarker candidates with multi-omics convergence' },
                  { icon: 'ü§ñ', title: 'AI Interpretation', desc: 'Get intelligent explanations powered by Claude AI' }
                ].map((f, i) => (<div key={i} className="card p-6 text-center"><div className="text-4xl mb-4">{f.icon}</div><h3 className="text-lg font-bold mb-2">{f.title}</h3><p className="text-slate-400 text-sm">{f.desc}</p></div>))}
            </div>
            <div className="card p-6">
                <h3 className="text-lg font-bold mb-4">Supported Cancer Types</h3>
                <div className="grid grid-cols-2 md:grid-cols-5 gap-3">
                    {Object.entries(CANCER_TYPES).map(([key, val]) => (
                        <button key={key} onClick={() => setCancerType(key)} className={`p-3 rounded-xl text-center transition ${cancerType === key ? 'bg-cyan-500/20 border border-cyan-500/50' : 'bg-slate-800/50 hover:bg-slate-700/50'}`}>
                            <div className="text-2xl mb-1">{val.icon}</div><div className="text-xs text-slate-400">{val.name}</div>
                        </button>
                    ))}
                </div>
            </div>
        </div>
    );

    const UploadPage = () => (
        <div className="fade-in space-y-6">
            <div><h1 className="text-3xl font-bold mb-2">Upload Data</h1><p className="text-slate-400">Add your omics data files for integrated analysis</p></div>
            <div className="drop-zone p-12 text-center cursor-pointer" onClick={() => fileRef.current?.click()}
                onDragOver={(e) => { e.preventDefault(); e.currentTarget.classList.add('dragover'); }}
                onDragLeave={(e) => e.currentTarget.classList.remove('dragover')}
                onDrop={(e) => { e.preventDefault(); e.currentTarget.classList.remove('dragover'); handleFiles(e.dataTransfer.files); }}>
                <input ref={fileRef} type="file" multiple hidden onChange={(e) => handleFiles(e.target.files)} accept=".csv,.tsv,.txt,.cct,.cbt,.gz" />
                <div className="text-5xl mb-4">üìÅ</div>
                <p className="text-lg mb-2">Drop files here or click to browse</p>
                <p className="text-sm text-slate-400">Supports .csv, .tsv, .txt, .cct, .cbt</p>
            </div>
            {layers.length > 0 && (
                <div className="card p-6">
                    <h3 className="font-bold mb-4">Uploaded Layers ({layers.length})</h3>
                    <div className="space-y-3">
                        {layers.map((l, i) => (
                            <div key={i} className="flex items-center justify-between p-4 rounded-xl bg-slate-800/50 flex-wrap gap-3">
                                <div className="flex items-center gap-3">
                                    <span className="text-2xl">{LAYER_TYPES[l.type]?.icon}</span>
                                    <div><div className="font-medium">{l.name || l.file?.name}</div><div className="text-sm text-slate-400">{LAYER_TYPES[l.type]?.name} ‚Ä¢ {l.genes?.toLocaleString()} genes</div></div>
                                </div>
                                <select value={l.type} onChange={(e) => { const n = [...layers]; n[i].type = e.target.value; setLayers(n); }} className="px-3 py-2 rounded-lg bg-slate-700 border border-slate-600 text-sm text-white">
                                    {Object.entries(LAYER_TYPES).map(([k, v]) => (<option key={k} value={k}>{v.icon} {v.name}</option>))}
                                </select>
                            </div>
                        ))}
                    </div>
                    <button onClick={runAnalysis} disabled={loading} className="btn-primary w-full mt-6 py-4 text-lg">{loading ? '‚ö° Processing...' : `‚ö° Run Analysis (${layers.length} layers)`}</button>
                </div>
            )}
            <p className="text-center"><button onClick={loadDemo} className="text-cyan-400 hover:underline">üéÆ Or try with demo TCGA breast cancer data</button></p>
        </div>
    );

    const ResultsPage = () => {
        if (!results) return <div className="text-center py-20 text-slate-400">No results yet.</div>;
        const chartData = results.findings?.slice(0, 6).map(f => ({ name: f.gene, value: f.evidence })) || [];
        return (
            <div className="fade-in space-y-6">
                <div className="flex items-start justify-between flex-wrap gap-4">
                    <div><h1 className="text-3xl font-bold mb-2">{results.story?.title}</h1><p className="text-slate-400">{results.story?.subtitle}</p></div>
                    <button onClick={() => generatePDF(results, layers)} className="btn-secondary flex items-center gap-2"><Icons.Download /> Export PDF</button>
                </div>
                <div className="grid grid-cols-2 md:grid-cols-6 gap-4">
                    {[{ value: layers.length, label: 'Layers', icon: 'üìÅ' }, { value: results.metrics?.novelDiscoveries || 0, label: 'Novel', icon: '‚≠ê' },
                      { value: results.metrics?.knownAlterations || 0, label: 'Known', icon: 'üìö' }, { value: results.metrics?.multiOmicsHits || 0, label: 'Multi-Omics', icon: 'üîó' },
                      { value: results.metrics?.pathwaysAffected || 0, label: 'Pathways', icon: 'üîÄ' }, { value: results.hypotheses?.length || 0, label: 'Hypotheses', icon: 'üí°' }
                    ].map((m, i) => (<div key={i} className="stat-card card p-4 text-center"><div className="text-xl mb-1">{m.icon}</div><div className="text-2xl font-bold gradient-text">{m.value}</div><div className="text-xs text-slate-400">{m.label}</div></div>))}
                </div>
                <div className="grid md:grid-cols-2 gap-6">
                    <div className="card p-6"><h3 className="font-bold mb-4">Evidence by Gene</h3><SimpleBarChart data={chartData} /></div>
                    <div className="card p-6 flex flex-col justify-center">
                        <h3 className="font-bold mb-4">Discovery Summary</h3>
                        <div className="space-y-4">
                            <div className="flex justify-between items-center p-3 rounded-lg bg-cyan-500/10"><span>Novel Candidates</span><span className="text-2xl font-bold text-cyan-400">{results.metrics?.novelDiscoveries || 0}</span></div>
                            <div className="flex justify-between items-center p-3 rounded-lg bg-violet-500/10"><span>Known Alterations</span><span className="text-2xl font-bold text-violet-400">{results.metrics?.knownAlterations || 0}</span></div>
                            <div className="flex justify-between items-center p-3 rounded-lg bg-amber-500/10"><span>Pathways Affected</span><span className="text-2xl font-bold text-amber-400">{results.metrics?.pathwaysAffected || 0}</span></div>
                        </div>
                    </div>
                </div>
                <div className="card p-6 bg-gradient-to-r from-cyan-500/10 to-violet-500/10 border-cyan-500/30">
                    <div className="flex items-center justify-between flex-wrap gap-4">
                        <div><div className="text-sm text-slate-400 mb-1">Predicted Subtype</div><div className="text-3xl font-bold gradient-text">{results.subtype?.predicted}</div><p className="text-slate-400 mt-2">{results.subtype?.description}</p></div>
                        <div className="text-center"><div className="text-4xl font-bold text-cyan-400">{results.subtype?.confidence}%</div><div className="text-sm text-slate-400">confidence</div></div>
                    </div>
                </div>
                <div className="card p-6 bg-gradient-to-r from-amber-500/10 to-orange-500/10 border-amber-500/30">
                    <div className="flex items-center gap-4"><div className="text-4xl">‚≠ê</div><div><div className="font-bold text-lg">{results.story?.keyInsight}</div><p className="text-slate-400">{results.story?.summary}</p></div></div>
                </div>
                {/* Tumor Microenvironment Section */}
                {results.deconvolution && (
                    <div className="card p-6">
                        <div className="flex items-center justify-between mb-4">
                            <div>
                                <h3 className="font-bold text-lg flex items-center gap-2">üî¨ Tumor Microenvironment</h3>
                                <p className="text-sm text-slate-400">Cell-type composition deconvolved from expression data</p>
                            </div>
                            <div className="text-center px-4 py-2 rounded-lg bg-gradient-to-r from-green-500/20 to-cyan-500/20">
                                <div className="text-2xl font-bold text-green-400">{results.deconvolution?.immunotherapy_score || 0}%</div>
                                <div className="text-xs text-slate-400">Immunotherapy Score</div>
                            </div>
                        </div>
                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="space-y-3">
                                {Object.entries(results.deconvolution?.cell_fractions || {}).sort((a,b) => b[1] - a[1]).map(([cell, pct]) => (
                                    <div key={cell} className="flex items-center gap-3">
                                        <div className="w-32 text-sm text-slate-300">{cell.replace(/_/g, " ")}</div>
                                        <div className="flex-1 h-6 bg-slate-700 rounded-full overflow-hidden">
                                            <div className="h-full rounded-full transition-all duration-500" style={{
                                                width: pct + "%",
                                                background: cell.includes("CD8") || cell.includes("NK") ? "linear-gradient(90deg, #10b981, #06b6d4)" :
                                                           cell.includes("Treg") || cell.includes("Macro") ? "linear-gradient(90deg, #f59e0b, #ef4444)" :
                                                           cell.includes("Tumor") ? "linear-gradient(90deg, #8b5cf6, #ec4899)" :
                                                           "linear-gradient(90deg, #6366f1, #8b5cf6)"
                                            }}></div>
                                        </div>
                                        <div className="w-16 text-right text-sm font-medium">{Number(pct).toFixed(1)}%</div>
                                    </div>
                                ))}
                            </div>
                            <div className="space-y-3">
                                <div className="p-4 rounded-lg bg-slate-800/50">
                                    <div className="text-sm text-slate-400 mb-2">Immune Infiltration</div>
                                    <div className="text-2xl font-bold text-cyan-400">{Number(results.deconvolution?.immune_infiltration || 0).toFixed(1)}%</div>
                                    <div className="text-xs text-slate-500">CD8+ T cells + NK cells</div>
                                </div>
                                {results.deconvolution?.insights?.map((insight, i) => (
                                    <div key={i} className={"p-3 rounded-lg text-sm " + (insight.type === "positive" ? "bg-green-500/10 text-green-300" : "bg-amber-500/10 text-amber-300")}>
                                        {insight.type === "positive" ? "‚úì " : "‚ö† "}{insight.text}
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                )}

            </div>
        );
    };

    const GenesPage = () => {
        if (!results) return null;
        return (
            <div className="fade-in space-y-6">
                <div><h1 className="text-3xl font-bold mb-2">Gene Findings</h1><p className="text-slate-400">Multi-omics convergence analysis results</p></div>
                <div className="flex gap-2 flex-wrap">
                    {['All', 'Novel ‚≠ê', 'Known üìö'].map((t, i) => (
                        <button key={t} onClick={() => setTab(i === 0 ? 'all' : i === 1 ? 'novel' : 'known')} className={`tab-pill ${tab === (i === 0 ? 'all' : i === 1 ? 'novel' : 'known') ? 'active' : ''}`}>{t}</button>
                    ))}
                </div>
                <div className="space-y-4">
                    {results.findings?.filter(f => tab === 'all' || (tab === 'novel' && f.isNovel) || (tab === 'known' && !f.isNovel)).map((f, i) => (
                        <div key={i} className="card p-5">
                            <div className="flex items-start justify-between mb-3 flex-wrap gap-2">
                                <div>
                                    <div className="flex items-center gap-3 mb-1 flex-wrap">
                                        <span className="text-xl font-bold gradient-text">{f.gene}</span>
                                        <span className={`px-2 py-0.5 rounded text-xs ${f.confidence === 'HIGH' ? 'bg-emerald-500/20 text-emerald-300' : 'bg-amber-500/20 text-amber-300'}`}>{f.confidence}</span>
                                        {f.isNovel && <span className="px-2 py-0.5 rounded text-xs bg-violet-500/20 text-violet-300">NOVEL</span>}
                                    </div>
                                    <div className="text-slate-400">{f.title}</div>
                                </div>
                                <div className="flex gap-1">{f.layers?.map(l => (<span key={l} className="text-xl" title={LAYER_TYPES[l]?.name}>{LAYER_TYPES[l]?.icon}</span>))}</div>
                            </div>
                            <div className="grid md:grid-cols-2 gap-2 mb-3">
                                {Object.entries(f.layerDetails || {}).map(([layer, detail]) => (
                                    <div key={layer} className="px-3 py-2 rounded bg-slate-800/50 text-sm flex items-center gap-2"><span className="text-slate-400">{LAYER_TYPES[layer]?.icon}</span><span>{detail}</span></div>
                                ))}
                            </div>
                            <p className="text-slate-400 text-sm mb-3">{f.biology}</p>
                            {f.drugs?.length > 0 && (<div className="flex gap-2 flex-wrap">{f.drugs.map(d => (<a key={d} href="https://www.oncokb.org/" target="_blank" rel="noopener noreferrer" className="px-3 py-1 rounded-full bg-emerald-500/20 text-emerald-300 text-sm hover:bg-emerald-500/30">üíä {d}</a>))}</div>)}
                        </div>
                    ))}
                </div>
            </div>
        );
    };

    const PathwaysPage = () => {
        if (!results) return null;
        return (
            <div className="fade-in space-y-6">
                <div><h1 className="text-3xl font-bold mb-2">Pathway Analysis</h1><p className="text-slate-400">Biological pathway enrichment and status</p></div>
                <div className="grid md:grid-cols-2 gap-4">
                    {results.pathways?.map((p, i) => (
                        <div key={i} className={`card p-5 border-l-4 ${p.status === 'ACTIVATED' ? 'border-rose-500' : 'border-blue-500'}`}>
                            <div className="flex items-center justify-between mb-3">
                                <h4 className="font-bold text-lg">{p.name}</h4>
                                <span className={`px-2 py-1 rounded text-xs ${p.status === 'ACTIVATED' ? 'bg-rose-500/20 text-rose-300' : 'bg-blue-500/20 text-blue-300'}`}>{p.status}</span>
                            </div>
                            <p className="text-sm text-slate-400 mb-3">{p.impact}</p>
                            <div className="flex flex-wrap gap-1 mb-3">{p.genes?.map((g, j) => (<span key={g} className={`px-2 py-1 rounded text-xs ${j < p.affected ? 'bg-violet-500/30 text-violet-200' : 'bg-slate-700/50 text-slate-400'}`}>{g}</span>))}</div>
                            {p.drugs?.length > 0 && (<div className="flex gap-1 flex-wrap">{p.drugs.map(d => (<span key={d} className="text-xs px-2 py-1 bg-emerald-500/20 text-emerald-300 rounded">üíä {d}</span>))}</div>)}
                        </div>
                    ))}
                </div>
            </div>
        );
    };

    const HypothesesPage = () => {
        if (!results) return null;
        return (
            <div className="fade-in space-y-6">
                <div><h1 className="text-3xl font-bold mb-2">Research Hypotheses</h1><p className="text-slate-400">AI-generated hypotheses based on multi-omics findings</p></div>
                {(!results.hypotheses || results.hypotheses.length === 0) ? (
                    <div className="card p-12 text-center"><div className="text-5xl mb-4">üí°</div><p className="text-slate-400">No hypotheses generated yet. Run an analysis first.</p></div>
                ) : (
                    <div className="space-y-6">
                        {results.hypotheses.map((h, i) => (
                            <div key={i} className="card p-6 border-l-4 border-amber-500">
                                <div className="flex items-start justify-between mb-4">
                                    <div>
                                        <span className="text-xs px-2 py-1 rounded-full bg-amber-500/20 text-amber-300 mr-2">Hypothesis #{h.rank || i+1}</span>
                                        <span className={"text-xs px-2 py-1 rounded-full " + (h.confidence === "HIGH" ? "bg-green-500/20 text-green-300" : "bg-yellow-500/20 text-yellow-300")}>{h.confidence} Confidence</span>
                                    </div>
                                    <span className="text-2xl">üß¨</span>
                                </div>
                                <h3 className="text-xl font-bold gradient-text mb-3">{h.title}</h3>
                                <div className="mb-4 p-4 rounded-lg bg-slate-800/50">
                                    <div className="text-sm text-slate-400 mb-1">Hypothesis</div>
                                    <p className="text-slate-200">{h.hypothesis}</p>
                                </div>
                                <div className="mb-4 p-4 rounded-lg bg-slate-800/50">
                                    <div className="text-sm text-slate-400 mb-1">Supporting Evidence</div>
                                    <p className="text-slate-300 text-sm">{h.evidence}</p>
                                </div>
                                {h.nextSteps && h.nextSteps.length > 0 && (
                                    <div className="mb-4">
                                        <div className="text-sm text-slate-400 mb-2">Recommended Next Steps</div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-2">
                                            {h.nextSteps.map((step, j) => (
                                                <div key={j} className="flex items-center gap-2 p-2 rounded-lg bg-slate-800/50 text-sm">
                                                    <span className="text-green-400">‚Üí</span>
                                                    <span className="text-slate-300">{step}</span>
                                                </div>
                                            ))}
                                        </div>
                                    </div>
                                )}
                                <div className="flex items-center gap-4 pt-4 border-t border-slate-700">
                                    <span className="text-xs text-slate-500">Publication Potential: <strong className={h.publicationPotential === "HIGH" ? "text-green-400" : "text-yellow-400"}>{h.publicationPotential}</strong></span>
                                    {h.gene && <span className="text-xs text-slate-500">Gene: <strong className="text-cyan-400">{h.gene}</strong></span>}
                                </div>
                            </div>
                        ))}
                    </div>
                )}
            </div>
        );
    };

    const AIPage = () => {
        if (!results) return null;
        return (
            <div className="fade-in flex flex-col" style={{ height: 'calc(100vh - 200px)' }}>
                <div className="mb-4"><h1 className="text-3xl font-bold mb-2">AI Assistant</h1><p className="text-slate-400">Ask questions about your analysis results</p></div>
                <div ref={chatRef} className="flex-1 overflow-y-auto space-y-3 p-4 rounded-xl bg-slate-900/50 mb-4">
                    {chat.length === 0 && (
                        <div className="py-8 text-center">
                            <div className="text-5xl mb-4">ü§ñ</div>
                            <p className="text-slate-400 mb-6">Ask me anything about your analysis!</p>
                            <div className="flex flex-wrap justify-center gap-2">
                                {["What are the key findings?", "Explain the subtype", "Treatment options?", "Tell me about PIK3CA"].map(q => (
                                    <button key={q} onClick={() => { setQuery(q); }} className="px-3 py-2 rounded-lg bg-slate-800 hover:bg-slate-700 text-sm">{q}</button>
                                ))}
                            </div>
                        </div>
                    )}
                    {chat.map((m, i) => (
                        <div key={i} className={`flex ${m.type === 'user' ? 'justify-end' : 'justify-start'}`}>
                            <div className={`max-w-[80%] px-4 py-3 rounded-2xl ${m.type === 'user' ? 'bg-gradient-to-r from-cyan-600 to-violet-600 text-white' : 'bg-slate-800 text-white'}`}>
                                <div className="whitespace-pre-wrap text-sm">{m.text}</div>
                            </div>
                        </div>
                    ))}
                </div>
                <div className="flex gap-3">
                    <input ref={queryRef} defaultValue="" onKeyPress={e => e.key === 'Enter' && handleQuery()} placeholder="Ask about genes, subtypes, pathways..." className="flex-1 px-4 py-3 rounded-xl bg-slate-800 border border-slate-700 focus:border-cyan-500 text-white placeholder-slate-400 outline-none" />
                    <button onClick={handleQuery} disabled={false} className="btn-primary px-6">Send</button>
                </div>
            </div>
        );
    };

    const renderPage = () => {
        switch (currentPage) {
            case 'home': return <HomePage />;
            case 'upload': return <UploadPage />;
            case 'results': return <ResultsPage />;
            case 'genes': return <GenesPage />;
            case 'pathways': return <PathwaysPage />;
            case 'hypotheses': return <HypothesesPage />;
            case 'ai': return <AIPage />;
            default: return <HomePage />;
        }
    };

    return (
        <div className="min-h-screen relative z-10">
            {isMobile && <MobileHeader />}
            {isMobile && mobileMenuOpen && <div className="fixed inset-0 bg-black/50 z-40" onClick={() => setMobileMenuOpen(false)} />}
            <Sidebar />
            <main className={`transition-all duration-300 ${isMobile ? 'pt-20 px-4 pb-6' : (sidebarOpen ? 'ml-[260px]' : 'ml-[72px]')} p-8`}>
                <div className="max-w-6xl mx-auto">{renderPage()}</div>
            </main>
            <a href="https://www.linkedin.com/in/rohitpk/" target="_blank" rel="noopener noreferrer" className="fixed bottom-6 right-6 bg-gradient-to-r from-blue-600 to-blue-500 hover:from-blue-500 hover:to-blue-400 text-white px-4 py-3 rounded-full shadow-lg flex items-center gap-2 z-50">
                <svg className="w-5 h-5" fill="currentColor" viewBox="0 0 24 24"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v6.067H9.351V9h3.414v6.061h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.086zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
                <span className="font-medium hidden sm:inline">Connect</span>
            </a>
        </div>
    );
}

ReactDOM.render(<App />, document.getElementById('root'));
</script>
</body>
</html>
